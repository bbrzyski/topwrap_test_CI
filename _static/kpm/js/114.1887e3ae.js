"use strict";(self.webpackChunkpipeline_manager=self.webpackChunkpipeline_manager||[]).push([[114],{55873:(e,n,t)=>{t.d(n,{E:()=>i,w:()=>a});var o=t(81025);class i extends o.l{constructor(e){super(),this.entity=e}emit(e){this.listeners.forEach((n=>n(e,this.entity)))}}class a extends o.l{constructor(e){super(),this.entity=e}emit(e){let n=!1;const t=()=>[n=!0];for(const o of Array.from(this.listeners.values()))if(o(e,t,this.entity),n)return{prevented:!0};return{prevented:!1}}}},12020:(e,n,t)=>{t.d(n,{FQ:()=>l,p$:()=>a});var o=t(81025);class i extends o.l{execute(e,n){let t=e;for(const e of this.listeners)t=e(t,n);return t}}class a extends i{constructor(e){super(),this.entity=e}execute(e){return super.execute(e,this.entity)}}class l extends o.l{constructor(e){super(),this.entity=e}execute(e){const n=[];for(const t of this.listeners)n.push(t(e,this.entity));return n}}},37886:(e,n,t)=>{t.d(n,{D:()=>i});var o=t(81025);function i(){const e=Symbol(),n=new Map,t=new Set,i=(t,i)=>{i instanceof o.l&&i.registerProxy(e,(()=>{var e,o;return null!==(o=null===(e=n.get(t))||void 0===e?void 0:e.listeners)&&void 0!==o?o:[]}))},a=e=>{t.add(e);for(const t of n.keys())i(t,e[t])},l=i=>{for(const t of n.keys())i[t]instanceof o.l&&i[t].unregisterProxy(e);t.delete(i)},s=()=>{t.forEach((e=>l(e))),n.clear()};return new Proxy({},{get:(e,r)=>"addTarget"===r?a:"removeTarget"===r?l:"destroy"===r?s:"string"!=typeof r||r.startsWith("_")?e[r]:(n.has(r)||(e=>{const a=new o.l;n.set(e,a),t.forEach((n=>i(e,n[e])))})(r),n.get(r))})}},81025:(e,n,t)=>{t.d(n,{l:()=>o});class o{constructor(){this.listenerMap=new Map,this._listeners=[],this.proxyMap=new Map,this.proxies=[]}get listeners(){return this._listeners.concat(this.proxies.flatMap((e=>e())))}subscribe(e,n){this.listenerMap.has(e)&&(console.warn("Already subscribed. Unsubscribing for you.\nPlease check that you don't accidentally use the same token twice to register two different handlers for the same event/hook."),this.unsubscribe(e)),this.listenerMap.set(e,n),this._listeners.push(n)}unsubscribe(e){if(this.listenerMap.has(e)){const n=this.listenerMap.get(e);this.listenerMap.delete(e);const t=this._listeners.indexOf(n);t>=0&&this._listeners.splice(t,1)}}registerProxy(e,n){this.proxyMap.has(e)&&(console.warn("Already subscribed. Unsubscribing for you.\nPlease check that you don't accidentally use the same token twice to register two different proxies for the same event/hook."),this.unregisterProxy(e)),this.proxyMap.set(e,n),this.proxies.push(n)}unregisterProxy(e){if(!this.proxyMap.has(e))return;const n=this.proxyMap.get(e);this.proxyMap.delete(e);const t=this.proxies.indexOf(n);t>=0&&this.proxies.splice(t,1)}}},3823:(e,n,t)=>{t.d(n,{Ac:()=>wn,Dz:()=>f,Hm:()=>y,J$:()=>oo,PG:()=>to,RM:()=>Fn,Sd:()=>Je,Ud:()=>ln,_N:()=>Bn,cg:()=>En,jg:()=>$n,n4:()=>h,z8:()=>lo,zp:()=>ao});var o=t(2262),i=t(66252),a=t(3577),l=t(49963),s=t(44773),r=t(88272),u=t(45521),d=t(88518),c=t(44653),p=t(70828),v=t(12020);let m=null;function f(){if(!m)throw new Error("providePlugin() must be called before usePlugin()");return{viewModel:m}}function h(){const{viewModel:e}=f();return{graph:(0,o.Vh)(e.value,"displayedGraph"),switchGraph:e.value.switchGraph}}function g(e){const{graph:n}=h(),t=(0,o.iH)(null),a=(0,o.iH)(null);return{dragging:(0,i.Fl)((()=>!!t.value)),onPointerDown:n=>{t.value={x:n.pageX,y:n.pageY},a.value={x:e.value.x,y:e.value.y}},onPointerMove:o=>{if(t.value){const i=o.pageX-t.value.x,l=o.pageY-t.value.y;e.value.x=a.value.x+i/n.value.scaling,e.value.y=a.value.y+l/n.value.scaling}},onPointerUp:()=>{t.value=null,a.value=null}}}function y(){const{graph:e}=h();return{transform:(n,t)=>[n/e.value.scaling-e.value.panning.x,t/e.value.scaling-e.value.panning.y]}}var w=(e=>(e[e.NONE=0]="NONE",e[e.ALLOWED=1]="ALLOWED",e[e.FORBIDDEN=2]="FORBIDDEN",e))(w||{});const b=(e,n)=>{const t=e.__vccOpts||e;for(const[e,o]of n)t[e]=o;return t},x=b((0,i.aZ)({setup(){const{viewModel:e}=f(),{graph:n}=h();return{styles:(0,i.Fl)((()=>{const t=e.value.settings.background,o=n.value.panning.x*n.value.scaling,i=n.value.panning.y*n.value.scaling,a=n.value.scaling*t.gridSize,l=a/t.gridDivision;return{backgroundPosition:`left ${o}px top ${i}px`,backgroundSize:`${a}px ${a}px, ${a}px ${a}px ${n.value.scaling>t.subGridVisibleThreshold?`, ${l}px ${l}px, ${l}px ${l}px`:""}`}}))}}}),[["render",function(e,n,t,o,l,s){return(0,i.wg)(),(0,i.iD)("div",{class:"background",style:(0,a.j5)(e.styles)},null,4)}]]);var k;const _="undefined"!=typeof window,C=e=>"string"==typeof e,M=()=>{};_&&(null==(k=null==window?void 0:window.navigator)?void 0:k.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);var E=Object.defineProperty,N=Object.defineProperties,I=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,O=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,H=(e,n,t)=>n in e?E(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,P=(e,n)=>{for(var t in n||(n={}))O.call(n,t)&&H(e,t,n[t]);if(D)for(var t of D(n))S.call(n,t)&&H(e,t,n[t]);return e},j=(e,n)=>N(e,I(n));function T(e){var n;const t="function"==typeof(i=e)?i():(0,o.SU)(i);var i;return null!=(n=null==t?void 0:t.$el)?n:t}const F=_?window:void 0;function V(...e){let n,t,a,l;if(C(e[0])||Array.isArray(e[0])?([t,a,l]=e,n=F):[n,t,a,l]=e,!n)return M;Array.isArray(t)||(t=[t]),Array.isArray(a)||(a=[a]);const s=[],r=()=>{s.forEach((e=>e())),s.length=0},u=(0,i.YP)((()=>T(n)),(e=>{r(),e&&s.push(...t.flatMap((n=>a.map((t=>((e,n,t)=>(e.addEventListener(n,t,l),()=>e.removeEventListener(n,t,l)))(e,n,t))))))}),{immediate:!0,flush:"post"}),d=()=>{u(),r()};var c;return c=d,(0,o.nZ)()&&(0,o.EB)(c),d}function W(e,n,t={}){const{window:o=F,ignore:i=[],capture:a=!0,detectIframe:l=!1}=t;if(!o)return;let s,r=!0;const u=e=>i.some((n=>{if("string"==typeof n)return Array.from(o.document.querySelectorAll(n)).some((n=>n===e.target||e.composedPath().includes(n)));{const t=T(n);return t&&(e.target===t||e.composedPath().includes(t))}})),d=t=>{o.clearTimeout(s);const i=T(e);i&&i!==t.target&&!t.composedPath().includes(i)&&(0===t.detail&&(r=!u(t)),r?n(t):r=!0)},c=[V(o,"click",d,{passive:!0,capture:a}),V(o,"pointerdown",(n=>{const t=T(e);t&&(r=!n.composedPath().includes(t)&&!u(n))}),{passive:!0}),V(o,"pointerup",(e=>{if(0===e.button){const n=e.composedPath();e.composedPath=()=>n,s=o.setTimeout((()=>d(e)),50)}}),{passive:!0}),l&&V(o,"blur",(t=>{var i;const a=T(e);"IFRAME"!==(null==(i=o.document.activeElement)?void 0:i.tagName)||(null==a?void 0:a.contains(o.document.activeElement))||n(t)}))].filter(Boolean);return()=>c.forEach((e=>e()))}_&&window.document,_&&window.navigator,_&&window.location;const U="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A="__vueuse_ssr_handlers__";U[A]=U[A]||{},U[A];var L=Object.defineProperty,$=Object.defineProperties,q=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertySymbols,z=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,G=(e,n,t)=>n in e?L(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;const Y={x:0,y:0,pointerId:0,pressure:0,tiltX:0,tiltY:0,width:0,height:0,twist:0,pointerType:null},K=Object.keys(Y);var Z,X;(X=Z||(Z={})).UP="UP",X.RIGHT="RIGHT",X.DOWN="DOWN",X.LEFT="LEFT",X.NONE="NONE";var Q=Object.defineProperty,J=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,te=(e,n,t)=>n in e?Q(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;((e,n)=>{for(var t in n||(n={}))ee.call(n,t)&&te(e,t,n[t]);if(J)for(var t of J(n))ne.call(n,t)&&te(e,t,n[t])})({linear:function(e){return e}},{easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]});const oe=(0,i.aZ)({props:{modelValue:{type:Boolean,default:!1},items:{type:Array,required:!0},x:{type:Number,default:0},y:{type:Number,default:0},isNested:{type:Boolean,default:!1},isFlipped:{type:Object,default:()=>({x:!1,y:!1})},flippable:{type:Boolean,default:!1}},emits:["click","update:modelValue"],setup(e,{emit:n}){let t=null;const a=(0,o.iH)(null),l=(0,o.iH)(-1),s=(0,o.iH)(0),r=(0,o.iH)({x:!1,y:!1}),u=(0,i.Fl)((()=>e.flippable&&(r.value.x||e.isFlipped.x))),d=(0,i.Fl)((()=>e.flippable&&(r.value.y||e.isFlipped.y))),c=(0,i.Fl)((()=>{const n={};return e.isNested||(n.top=(d.value?e.y-s.value:e.y)+"px",n.left=e.x+"px"),n})),p=(0,i.Fl)((()=>({"--flipped-x":u.value,"--flipped-y":d.value,"--nested":e.isNested}))),v=(0,i.Fl)((()=>e.items.map((e=>({...e,hover:!1})))));return(0,i.YP)([()=>e.y,()=>e.items],(()=>{var n,t,o,i;s.value=30*e.items.length;const l=(null==(t=null==(n=a.value)?void 0:n.parentElement)?void 0:t.offsetWidth)??0,u=(null==(i=null==(o=a.value)?void 0:o.parentElement)?void 0:i.offsetHeight)??0;r.value.x=!e.isNested&&e.x>.75*l,r.value.y=!e.isNested&&e.y+s.value>u-20})),W(a,(()=>{e.modelValue&&n("update:modelValue",!1)})),{el:a,activeMenu:l,flippedX:u,flippedY:d,styles:c,classes:p,itemsWithHoverProperty:v,onClick:e=>{!e.submenu&&e.value&&(n("click",e.value),n("update:modelValue",!1))},onChildClick:t=>{n("click",t),l.value=-1,e.isNested||n("update:modelValue",!1)},onClickOutside:W,onMouseEnter:(n,o)=>{e.items[o].submenu&&(l.value=o,null!==t&&(clearTimeout(t),t=null))},onMouseLeave:(n,o)=>{e.items[o].submenu&&(t=window.setTimeout((()=>{l.value=-1,t=null}),200))}}}}),ie=["onMouseenter","onMouseleave","onClick"],ae={class:"flex-fill"},le={key:0,class:"__submenu-icon",style:{"line-height":"1em"}},se=[(0,i._)("svg",{width:"13",height:"13",viewBox:"-60 120 250 250"},[(0,i._)("path",{d:"M160.875 279.5625 L70.875 369.5625 L70.875 189.5625 L160.875 279.5625 Z",stroke:"none",fill:"white"})],-1)],re=b(oe,[["render",function(e,n,t,o,s,r){const u=(0,i.up)("context-menu",!0);return(0,i.wg)(),(0,i.j4)(l.uT,{name:"slide-fade"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i._)("div",{ref:"el",class:(0,a.C_)(["baklava-context-menu",e.classes]),style:(0,a.j5)(e.styles)},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.itemsWithHoverProperty,((n,t)=>((0,i.wg)(),(0,i.iD)(i.HY,null,[n.isDivider?((0,i.wg)(),(0,i.iD)("div",{key:`d-${t}`,class:"divider"})):((0,i.wg)(),(0,i.iD)("div",{key:`i-${t}`,class:(0,a.C_)(["item",{submenu:!!n.submenu,"--disabled":!!n.disabled}]),onMouseenter:n=>e.onMouseEnter(n,t),onMouseleave:n=>e.onMouseLeave(n,t),onClick:(0,l.iM)((t=>e.onClick(n)),["stop","prevent"])},[(0,i._)("div",ae,(0,a.zw)(n.label),1),n.submenu?((0,i.wg)(),(0,i.iD)("div",le,se)):(0,i.kq)("",!0),n.submenu?((0,i.wg)(),(0,i.j4)(u,{key:1,value:e.activeMenu===t,items:n.submenu,"is-nested":!0,"is-flipped":{x:e.flippedX,y:e.flippedY},flippable:e.flippable,onClick:e.onChildClick},null,8,["value","items","is-flipped","flippable","onClick"])):(0,i.kq)("",!0)],42,ie))],64)))),256))],6),[[l.F8,e.modelValue]])])),_:1})}]]),ue={},de={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"16",height:"16",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},ce=[(0,i._)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i._)("circle",{cx:"12",cy:"12",r:"1"},null,-1),(0,i._)("circle",{cx:"12",cy:"19",r:"1"},null,-1),(0,i._)("circle",{cx:"12",cy:"5",r:"1"},null,-1)],pe=b(ue,[["render",function(e,n){return(0,i.wg)(),(0,i.iD)("svg",de,ce)}]]),ve=(0,i.aZ)({props:{node:{type:Object,required:!0},intf:{type:Object,required:!0}},setup(e){const{viewModel:n}=f(),t=(0,i.f3)("hoveredOver"),a=(0,o.iH)(null),l=(0,i.Fl)((()=>e.intf.connectionCount>0)),s=(0,i.Fl)((()=>({"--input":e.intf.isInput,"--output":!e.intf.isInput,"--connected":l.value}))),r=(0,i.Fl)((()=>e.intf.component&&0===e.intf.connectionCount&&(e.intf.isInput||!e.intf.port))),u=()=>{a.value&&n.value.hooks.renderInterface.execute({intf:e.intf,el:a.value})};return(0,i.bv)(u),(0,i.ic)(u),{el:a,isConnected:l,classes:s,showComponent:r,startHover:()=>{t(e.intf)},endHover:()=>{t(void 0)},openSidebar:()=>{const t=n.value.displayedGraph.sidebar;t.nodeId=e.node.id,t.optionName=e.intf.name,t.visible=!0}}}}),me=["id"],fe={key:2,class:"align-middle"},he=b(ve,[["render",function(e,n,t,o,l,s){return(0,i.wg)(),(0,i.iD)("div",{id:e.intf.id,ref:"el",class:(0,a.C_)(["baklava-node-interface",e.classes])},[e.intf.port?((0,i.wg)(),(0,i.iD)("div",{key:0,class:"__port",onPointerover:n[0]||(n[0]=(...n)=>e.startHover&&e.startHover(...n)),onPointerout:n[1]||(n[1]=(...n)=>e.endHover&&e.endHover(...n))},null,32)):(0,i.kq)("",!0),e.showComponent?((0,i.wg)(),(0,i.j4)((0,i.LL)(e.intf.component),{key:1,modelValue:e.intf.value,"onUpdate:modelValue":n[2]||(n[2]=n=>e.intf.value=n),node:e.node,intf:e.intf,onOpenSidebar:e.openSidebar},null,40,["modelValue","node","intf","onOpenSidebar"])):((0,i.wg)(),(0,i.iD)("span",fe,(0,a.zw)(e.intf.name),1))],10,me)}]]),ge=["id","data-node-type"],ye=["onPointerdown"],we={class:"__title-label"},be={class:"__menu"},xe=["onKeydown"],ke={class:"__content"},_e={class:"__outputs"},Ce={class:"__inputs"},Me=(0,i.aZ)({__name:"Node",props:{node:null,selected:{type:Boolean,default:!1}},emits:["select"],setup(e,{emit:n}){const t=e,{viewModel:r}=f(),{graph:u,switchGraph:d}=h(),c=g((0,o.Vh)(t.node,"position")),p=(0,o.iH)(null),v=(0,o.iH)(!1),m=(0,o.iH)(""),y=(0,o.iH)(null),w=(0,o.iH)(!1),b=(0,i.Fl)((()=>{const e=[{value:"rename",label:"Rename"},{value:"delete",label:"Delete"}];return t.node.type.startsWith(s.qM)&&e.push({value:"editSubgraph",label:"Edit Subgraph"}),e})),x=(0,i.Fl)((()=>({"--selected":t.selected,"--dragging":c.dragging.value,"--two-column":!!t.node.twoColumn}))),k=(0,i.Fl)((()=>{var e,n;return{top:`${(null==(e=t.node.position)?void 0:e.y)??0}px`,left:`${(null==(n=t.node.position)?void 0:n.x)??0}px`,width:`${t.node.width??200}px`}})),_=(0,i.Fl)((()=>Object.values(t.node.inputs).filter((e=>!e.hidden)))),C=(0,i.Fl)((()=>Object.values(t.node.outputs).filter((e=>!e.hidden)))),M=()=>{n("select")},E=e=>{c.onPointerDown(e),document.addEventListener("pointermove",c.onPointerMove),document.addEventListener("pointerup",N),M()},N=()=>{c.onPointerUp(),document.removeEventListener("pointermove",c.onPointerMove),document.removeEventListener("pointerup",N)},I=()=>{w.value=!0},D=async e=>{var n;switch(e){case"delete":u.value.removeNode(t.node);break;case"rename":m.value=t.node.title,v.value=!0,await(0,i.Y3)(),null==(n=y.value)||n.focus();break;case"editSubgraph":d(t.node.template)}},O=()=>{t.node.title=m.value,v.value=!1},S=()=>{p.value&&r.value.hooks.renderNode.execute({node:t.node,el:p.value})};return(0,i.bv)(S),(0,i.ic)(S),(n,t)=>((0,i.wg)(),(0,i.iD)("div",{id:e.node.id,ref_key:"el",ref:p,class:(0,a.C_)(["baklava-node",(0,o.SU)(x)]),style:(0,a.j5)((0,o.SU)(k)),"data-node-type":e.node.type,onPointerdown:M},[(0,i._)("div",{class:"__title",onPointerdown:(0,l.iM)(E,["self","stop"])},[v.value?(0,i.wy)(((0,i.wg)(),(0,i.iD)("input",{key:1,ref_key:"renameInputEl",ref:y,"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),type:"text",class:"baklava-input",placeholder:"Node Name",onBlur:O,onKeydown:(0,l.D2)(O,["enter"])},null,40,xe)),[[l.nr,m.value]]):((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[(0,i._)("div",we,(0,a.zw)(e.node.title),1),(0,i._)("div",be,[(0,i.Wm)(pe,{class:"--clickable",onClick:I}),(0,i.Wm)(re,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),x:0,y:0,items:(0,o.SU)(b),onClick:D},null,8,["modelValue","items"])])],64))],40,ye),(0,i._)("div",ke,[(0,i._)("div",_e,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,o.SU)(C),(n=>((0,i.wg)(),(0,i.j4)(he,{key:n.id,node:e.node,intf:n},null,8,["node","intf"])))),128))]),(0,i._)("div",Ce,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,o.SU)(_),(n=>((0,i.wg)(),(0,i.j4)(he,{key:n.id,node:e.node,intf:n},null,8,["node","intf"])))),128))])])],46,ge))}}),Ee=(0,i.aZ)({props:{x1:{type:Number,required:!0},y1:{type:Number,required:!0},x2:{type:Number,required:!0},y2:{type:Number,required:!0},state:{type:Number,default:w.NONE},isTemporary:{type:Boolean,default:!1}},setup(e){const{viewModel:n}=f(),{graph:t}=h(),o=(e,n)=>[(e+t.value.panning.x)*t.value.scaling,(n+t.value.panning.y)*t.value.scaling];return{d:(0,i.Fl)((()=>{const[t,i]=o(e.x1,e.y1),[a,l]=o(e.x2,e.y2);if(n.value.settings.useStraightConnections)return`M ${t} ${i} L ${a} ${l}`;{const e=.3*Math.abs(t-a);return`M ${t} ${i} C ${t+e} ${i}, ${a-e} ${l}, ${a} ${l}`}})),classes:(0,i.Fl)((()=>({"--temporary":e.isTemporary,"--allowed":e.state===w.ALLOWED,"--forbidden":e.state===w.FORBIDDEN})))}}}),Ne=["d"],Ie=b(Ee,[["render",function(e,n,t,o,l,s){return(0,i.wg)(),(0,i.iD)("path",{class:(0,a.C_)(["baklava-connection",e.classes]),d:e.d},null,10,Ne)}]]);function De(e){const n=document.getElementById(e.id),t=null==n?void 0:n.getElementsByClassName("__port");return{node:(null==n?void 0:n.closest(".baklava-node"))??null,interface:n,port:t&&t.length>0?t[0]:null}}const Oe=b((0,i.aZ)({components:{"connection-view":Ie},props:{connection:{type:Object,required:!0}},setup(e){const{graph:n}=h();let t;const a=(0,o.iH)({x1:0,y1:0,x2:0,y2:0}),l=(0,i.Fl)((()=>e.connection.isInDanger?w.FORBIDDEN:w.NONE)),s=(0,i.Fl)((()=>{var t;return null==(t=n.value.findNodeById(e.connection.from.nodeId))?void 0:t.position})),r=(0,i.Fl)((()=>{var t;return null==(t=n.value.findNodeById(e.connection.to.nodeId))?void 0:t.position})),u=e=>e.node&&e.interface&&e.port?[e.node.offsetLeft+e.interface.offsetLeft+e.port.offsetLeft+e.port.clientWidth/2,e.node.offsetTop+e.interface.offsetTop+e.port.offsetTop+e.port.clientHeight/2]:[0,0],d=()=>{const n=De(e.connection.from),o=De(e.connection.to);n.node&&o.node&&(t||(t=new ResizeObserver((()=>{d()})),t.observe(n.node),t.observe(o.node)));const[i,l]=u(n),[s,r]=u(o);a.value={x1:i,y1:l,x2:s,y2:r}};return(0,i.bv)((async()=>{await(0,i.Y3)(),d()})),(0,i.Jd)((()=>{t&&t.disconnect()})),(0,i.YP)([s,r],(()=>d()),{deep:!0}),{d:a,state:l}}}),[["render",function(e,n,t,o,a,l){const s=(0,i.up)("connection-view");return(0,i.wg)(),(0,i.j4)(s,{x1:e.d.x1,y1:e.d.y1,x2:e.d.x2,y2:e.d.y2,state:e.state},null,8,["x1","y1","x2","y2","state"])}]]);function Se(e){return e.node&&e.interface&&e.port?[e.node.offsetLeft+e.interface.offsetLeft+e.port.offsetLeft+e.port.clientWidth/2,e.node.offsetTop+e.interface.offsetTop+e.port.offsetTop+e.port.clientHeight/2]:[0,0]}const He=b((0,i.aZ)({components:{"connection-view":Ie},props:{connection:{type:Object,required:!0}},setup(e){const n=(0,i.Fl)((()=>e.connection?e.connection.status:w.NONE));return{d:(0,i.Fl)((()=>{if(!e.connection)return{input:[0,0],output:[0,0]};const n=Se(De(e.connection.from)),t=e.connection.to?Se(De(e.connection.to)):[e.connection.mx||n[0],e.connection.my||n[1]];return e.connection.from.isInput?{input:t,output:n}:{input:n,output:t}})),status:n}}}),[["render",function(e,n,t,o,a,l){const s=(0,i.up)("connection-view");return(0,i.wg)(),(0,i.j4)(s,{x1:e.d.input[0],y1:e.d.input[1],x2:e.d.output[0],y2:e.d.output[1],state:e.status,"is-temporary":""},null,8,["x1","y1","x2","y2","state"])}]]),Pe=(0,i.aZ)({setup(){const{graph:e}=h(),n=(0,o.iH)(null),t=(0,o.iH)(300),a=(0,i.Fl)((()=>{const n=e.value.sidebar.nodeId;return e.value.nodes.find((e=>e.id===n))})),l=(0,i.Fl)((()=>({width:`${t.value}px`}))),s=(0,i.Fl)((()=>a.value?[...Object.values(a.value.inputs),...Object.values(a.value.outputs)].filter((e=>e.displayInSidebar&&e.component)):[])),r=e=>{var o,i;const a=(null==(i=null==(o=n.value)?void 0:o.parentElement)?void 0:i.getBoundingClientRect().width)??500;t.value-=e.movementX,t.value<300?t.value=300:t.value>.9*a&&(t.value=.9*a)};return{el:n,graph:e,node:a,styles:l,displayedInterfaces:s,startResize:()=>{window.addEventListener("mousemove",r),window.addEventListener("mouseup",(()=>{window.removeEventListener("mousemove",r)}),{once:!0})},close:()=>{e.value.sidebar.visible=!1}}}}),je={class:"__header"},Te={class:"__node-name"},Fe=b(Pe,[["render",function(e,n,t,o,l,s){return(0,i.wg)(),(0,i.iD)("div",{ref:"el",class:(0,a.C_)(["baklava-sidebar",{"--open":e.graph.sidebar.visible}]),style:(0,a.j5)(e.styles)},[(0,i._)("div",{class:"__resizer",onMousedown:n[0]||(n[0]=(...n)=>e.startResize&&e.startResize(...n))},null,32),(0,i._)("div",je,[(0,i._)("button",{tabindex:"-1",class:"__close",onClick:n[1]||(n[1]=(...n)=>e.close&&e.close(...n))}," × "),(0,i._)("div",Te,[(0,i._)("b",null,(0,a.zw)(e.node?e.node.title:""),1)])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.displayedInterfaces,(n=>((0,i.wg)(),(0,i.iD)("div",{key:n.id,class:"__interface"},[((0,i.wg)(),(0,i.j4)((0,i.LL)(n.component),{modelValue:n.value,"onUpdate:modelValue":e=>n.value=e,node:e.node,intf:n},null,8,["modelValue","onUpdate:modelValue","node","intf"]))])))),128))],6)}]]),Ve=b((0,i.aZ)({setup(){const{viewModel:e}=f(),{graph:n}=h(),t=(0,o.iH)(null),a=(0,o.iH)(!1);let l,s=!1,r={x1:0,y1:0,x2:0,y2:0};const u=(e,n)=>[(e-r.x1)/(r.x2-r.x1)*l.canvas.clientWidth,(n-r.y1)/(r.y2-r.y1)*l.canvas.clientHeight],d=e=>{if(e){const n=e.querySelector(".__content");if(n){const e=c(n);if(e)return e}const t=c(e);if(t)return t}return"gray"},c=e=>{const n=getComputedStyle(e).backgroundColor;if(n&&"rgba(0, 0, 0, 0)"!==n)return n},p=()=>{const e=t.value.parentElement.offsetWidth,o=t.value.parentElement.offsetHeight,i=e/n.value.scaling-n.value.panning.x,a=o/n.value.scaling-n.value.panning.y;return{x1:-n.value.panning.x,y1:-n.value.panning.y,x2:i,y2:a}},v=e=>{if(s){const[i,a]=(t=e.offsetX,o=e.offsetY,[t*(r.x2-r.x1)/l.canvas.clientWidth+r.x1,o*(r.y2-r.y1)/l.canvas.clientHeight+r.y1]),s=p(),u=(s.x1-s.x2)/2,d=(s.y1-s.y2)/2;n.value.panning.x=-(i+u),n.value.panning.y=-(a+d)}var t,o},m=()=>{s=!1};return(0,i.bv)((()=>{l=t.value.getContext("2d"),l.imageSmoothingQuality="high",(()=>{var t,o;if(!l)return;const i=new Map,s=new Map;for(const e of n.value.nodes){const n=(c=e,document.getElementById(c.id)),a=(null==n?void 0:n.clientWidth)??0,l=(null==n?void 0:n.clientHeight)??0,r=(null==(t=e.position)?void 0:t.x)??0,u=(null==(o=e.position)?void 0:o.y)??0;i.set(e,{x1:r,y1:u,x2:r+a,y2:u+l}),s.set(e,n)}var c;const v={x1:Number.MAX_SAFE_INTEGER,y1:Number.MAX_SAFE_INTEGER,x2:Number.MIN_SAFE_INTEGER,y2:Number.MIN_SAFE_INTEGER};for(const e of i.values())e.x1<v.x1&&(v.x1=e.x1),e.y1<v.y1&&(v.y1=e.y1),e.x2>v.x2&&(v.x2=e.x2),e.y2>v.y2&&(v.y2=e.y2);v.x1-=50,v.y1-=50,v.x2+=50,v.y2+=50,r=v,l.clearRect(0,0,l.canvas.width,l.canvas.height),l.strokeStyle="white";for(const t of n.value.connections){const[n,o]=Se(De(t.from)),[i,a]=Se(De(t.to)),[s,r]=u(n,o),[d,c]=u(i,a);if(l.beginPath(),l.moveTo(s,r),e.value.settings.useStraightConnections)l.lineTo(d,c);else{const e=.3*Math.abs(s-d);l.bezierCurveTo(s+e,r,d-e,c,d,c)}l.stroke()}l.strokeStyle="lightgray";for(const[e,n]of i.entries()){const[t,o]=u(n.x1,n.y1),[i,a]=u(n.x2,n.y2);l.fillStyle=d(s.get(e)),l.beginPath(),l.rect(t,o,i-t,a-o),l.fill(),l.stroke()}if(a.value){const e=p(),[n,t]=u(e.x1,e.y1),[o,i]=u(e.x2,e.y2);l.fillStyle="rgba(255, 255, 255, 0.2)",l.fillRect(n,t,o-n,i-t)}})()})),{canvas:t,showViewBounds:a,mousedown:e=>{0===e.button&&(s=!0,v(e))},mousemove:v,mouseup:m,mouseenter:()=>{a.value=!0},mouseleave:()=>{a.value=!1,m()}}}}),[["render",function(e,n,t,o,a,s){return(0,i.wg)(),(0,i.iD)("canvas",{ref:"canvas",class:"baklava-minimap",onMouseenter:n[0]||(n[0]=(...n)=>e.mouseenter&&e.mouseenter(...n)),onMouseleave:n[1]||(n[1]=(...n)=>e.mouseleave&&e.mouseleave(...n)),onMousedown:n[2]||(n[2]=(0,l.iM)(((...n)=>e.mousedown&&e.mousedown(...n)),["self"])),onMousemove:n[3]||(n[3]=(0,l.iM)(((...n)=>e.mousemove&&e.mousemove(...n)),["self"])),onMouseup:n[4]||(n[4]=(...n)=>e.mouseup&&e.mouseup(...n))},null,544)}]]),We=(0,i.aZ)({components:{ContextMenu:re,VerticalDots:pe},props:{type:{type:String,required:!0},title:{type:String,required:!0}},setup(e){const{viewModel:n}=f(),{switchGraph:t}=h(),a=(0,o.iH)(!1),l=(0,i.Fl)((()=>e.type.startsWith(s.qM)));return{showContextMenu:a,hasContextMenu:l,contextMenuItems:[{label:"Edit Subgraph",value:"editSubgraph"},{label:"Delete Subgraph",value:"deleteSubgraph"}],openContextMenu:()=>{a.value=!0},onContextMenuClick:o=>{const i=e.type.substring(s.qM.length),a=n.value.editor.graphTemplates.find((e=>e.id===i));if(a)switch(o){case"editSubgraph":t(a);break;case"deleteSubgraph":n.value.editor.removeGraphTemplate(a)}}}}}),Ue=["data-node-type"],Ae={class:"__title"},Le={class:"__title-label"},$e={key:0,class:"__menu"},qe=b(We,[["render",function(e,n,t,o,s,r){const u=(0,i.up)("vertical-dots"),d=(0,i.up)("context-menu");return(0,i.wg)(),(0,i.iD)("div",{class:"baklava-node --palette","data-node-type":e.type},[(0,i._)("div",Ae,[(0,i._)("div",Le,(0,a.zw)(e.title),1),e.hasContextMenu?((0,i.wg)(),(0,i.iD)("div",$e,[(0,i.Wm)(u,{class:"--clickable",onPointerdown:n[0]||(n[0]=(0,l.iM)((()=>{}),["stop","prevent"])),onClick:(0,l.iM)(e.openContextMenu,["stop","prevent"])},null,8,["onClick"]),(0,i.Wm)(d,{modelValue:e.showContextMenu,"onUpdate:modelValue":n[1]||(n[1]=n=>e.showContextMenu=n),x:-100,y:0,items:e.contextMenuItems,onClick:e.onContextMenuClick,onPointerdown:n[2]||(n[2]=(0,l.iM)((()=>{}),["stop","prevent"]))},null,8,["modelValue","items","onClick"])])):(0,i.kq)("",!0)])],8,Ue)}]]);let Be;const ze=new Uint8Array(16);function Re(){if(!Be&&(Be="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Be))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Be(ze)}const Ge=[];for(let e=0;e<256;++e)Ge.push((e+256).toString(16).slice(1));const Ye={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ke(e,n,t){if(Ye.randomUUID&&!n&&!e)return Ye.randomUUID();const o=(e=e||{}).random||(e.rng||Re)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,n){t=t||0;for(let e=0;e<16;++e)n[t+e]=o[e];return n}return function(e,n=0){return(Ge[e[n+0]]+Ge[e[n+1]]+Ge[e[n+2]]+Ge[e[n+3]]+"-"+Ge[e[n+4]]+Ge[e[n+5]]+"-"+Ge[e[n+6]]+Ge[e[n+7]]+"-"+Ge[e[n+8]]+Ge[e[n+9]]+"-"+Ge[e[n+10]]+Ge[e[n+11]]+Ge[e[n+12]]+Ge[e[n+13]]+Ge[e[n+14]]+Ge[e[n+15]]).toLowerCase()}(o)}const Ze=(0,i.aZ)({props:{intf:{type:Object,required:!0}},setup:e=>({onClick:()=>{e.intf.callback&&e.intf.callback()}})}),Xe=["title"],Qe=b(Ze,[["render",function(e,n,t,o,l,s){return(0,i.wg)(),(0,i.iD)("button",{class:"baklava-button --block",title:e.intf.name,onClick:n[0]||(n[0]=(...n)=>e.onClick&&e.onClick(...n))},(0,a.zw)(e.intf.name),9,Xe)}]]);class Je extends r.I{constructor(e,n){super(e,void 0),this.component=(0,o.Xl)(Qe),this.callback=n,this.setPort(!1)}}const en=(0,i.aZ)({props:{intf:{type:Object,required:!0}}}),nn=["title"],tn=(0,i._)("div",{class:"__checkmark-container"},[(0,i._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18"},[(0,i._)("path",{class:"__checkmark",d:"M 6 5 L 6 10 L 16 10",transform:"rotate(-45 10 10)"})])],-1),on={class:"__label"},an=b(en,[["render",function(e,n,t,o,l,s){return(0,i.wg)(),(0,i.iD)("div",{class:(0,a.C_)(["baklava-checkbox",{"--checked":e.intf.value}]),title:e.intf.name,onClick:n[0]||(n[0]=n=>e.intf.value=!e.intf.value)},[tn,(0,i._)("div",on,(0,a.zw)(e.intf.name),1)],10,nn)}]]);class ln extends r.I{constructor(){super(...arguments),this.component=(0,o.Xl)(an)}}class sn extends r.I{constructor(e,n,t,o){super(e,n),this.min=t,this.max=o}validate(e){return(!this.min||e>=this.min)&&(!this.max||e<=this.max)}}const rn=(e,n=3)=>{const t=(0,o.iH)(null),a=(0,o.iH)(!1),l=(0,o.iH)(!1),s=(0,o.iH)("0"),r=(0,i.Fl)((()=>{const t=e.value.value.toFixed(n);return t.length>9?e.value.value.toExponential(4):t})),u=n=>!Number.isNaN(n)&&(!function(e){return"validate"in e}(e.value)||e.value.validate(n)),d=n=>{u(n)&&(e.value.value=n)};return(0,i.YP)(s,(()=>{l.value=!1})),{editMode:a,invalid:l,tempValue:s,inputEl:t,stringRepresentation:r,validate:u,setValue:d,enterEditMode:async()=>{s.value=e.value.value.toFixed(n),a.value=!0,await(0,i.Y3)(),t.value&&t.value.focus()},leaveEditMode:()=>{const e=parseFloat(s.value);u(e)?(d(e),a.value=!1):l.value=!0}}},un={},dn={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},cn=[(0,i._)("polyline",{points:"6 9 12 15 18 9"},null,-1)],pn=b(un,[["render",function(e,n){return(0,i.wg)(),(0,i.iD)("svg",dn,cn)}]]),vn=(0,i.aZ)({components:{"i-arrow":pn},props:{intf:{type:Object,required:!0}},setup(e){const n=rn((0,o.Vh)(e,"intf"),0);return{...n,increment:()=>{n.setValue(e.intf.value+1)},decrement:()=>{n.setValue(e.intf.value-1)}}}}),mn={class:"baklava-num-input"},fn=["title"],hn={class:"__value"},gn={key:1,class:"__content"},yn=b(vn,[["render",function(e,n,t,o,s,r){const u=(0,i.up)("i-arrow");return(0,i.wg)(),(0,i.iD)("div",mn,[(0,i._)("div",{class:"__button --dec",onClick:n[0]||(n[0]=(...n)=>e.decrement&&e.decrement(...n))},[(0,i.Wm)(u)]),e.editMode?((0,i.wg)(),(0,i.iD)("div",gn,[(0,i.wy)((0,i._)("input",{ref:"inputEl","onUpdate:modelValue":n[2]||(n[2]=n=>e.tempValue=n),type:"number",class:(0,a.C_)(["baklava-input",{"--invalid":e.invalid}]),style:{"text-align":"right"},onBlur:n[3]||(n[3]=(...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),onKeydown:n[4]||(n[4]=(0,l.D2)(((...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),["enter"]))},null,34),[[l.nr,e.tempValue]])])):((0,i.wg)(),(0,i.iD)("div",{key:0,class:"__content",onClick:n[1]||(n[1]=(...n)=>e.enterEditMode&&e.enterEditMode(...n))},[(0,i._)("div",{class:"__label",title:e.intf.name},(0,a.zw)(e.intf.name),9,fn),(0,i._)("div",hn,(0,a.zw)(e.stringRepresentation),1)])),(0,i._)("div",{class:"__button --inc",onClick:n[5]||(n[5]=(...n)=>e.increment&&e.increment(...n))},[(0,i.Wm)(u)])])}]]);class wn extends sn{constructor(){super(...arguments),this.component=(0,o.Xl)(yn)}validate(e){return Number.isInteger(e)&&super.validate(e)}}const bn=(0,i.aZ)({components:{"i-arrow":pn},props:{intf:{type:Object,required:!0}},setup(e){const n=rn((0,o.Vh)(e,"intf"));return{...n,increment:()=>{n.setValue(e.intf.value+.1)},decrement:()=>{n.setValue(e.intf.value-.1)}}}}),xn={class:"baklava-num-input"},kn=["title"],_n={class:"__value"},Cn={key:1,class:"__content"},Mn=b(bn,[["render",function(e,n,t,o,s,r){const u=(0,i.up)("i-arrow");return(0,i.wg)(),(0,i.iD)("div",xn,[(0,i._)("div",{class:"__button --dec",onClick:n[0]||(n[0]=(...n)=>e.decrement&&e.decrement(...n))},[(0,i.Wm)(u)]),e.editMode?((0,i.wg)(),(0,i.iD)("div",Cn,[(0,i.wy)((0,i._)("input",{ref:"inputEl","onUpdate:modelValue":n[2]||(n[2]=n=>e.tempValue=n),type:"number",class:(0,a.C_)(["baklava-input",{"--invalid":e.invalid}]),style:{"text-align":"right"},onBlur:n[3]||(n[3]=(...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),onKeydown:n[4]||(n[4]=(0,l.D2)(((...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),["enter"]))},null,34),[[l.nr,e.tempValue]])])):((0,i.wg)(),(0,i.iD)("div",{key:0,class:"__content",onClick:n[1]||(n[1]=(...n)=>e.enterEditMode&&e.enterEditMode(...n))},[(0,i._)("div",{class:"__label",title:e.intf.name},(0,a.zw)(e.intf.name),9,kn),(0,i._)("div",_n,(0,a.zw)(e.stringRepresentation),1)])),(0,i._)("div",{class:"__button --inc",onClick:n[5]||(n[5]=(...n)=>e.increment&&e.increment(...n))},[(0,i.Wm)(u)])])}]]);class En extends sn{constructor(){super(...arguments),this.component=(0,o.Xl)(Mn)}}const Nn=(0,i.aZ)({components:{"i-arrow":pn},props:{intf:{type:Object,required:!0}},setup(e){const n=(0,o.iH)(null),t=(0,o.iH)(!1),a=(0,i.Fl)((()=>e.intf.items.find((n=>"string"==typeof n?n===e.intf.value:n.value===e.intf.value)))),l=(0,i.Fl)((()=>a.value?"string"==typeof a.value?a.value:a.value.text:""));return W(n,(()=>{t.value=!1})),{el:n,open:t,selectedItem:a,selectedText:l,setSelected:n=>{e.intf.value="string"==typeof n?n:n.value}}}}),In=["title"],Dn={class:"__selected"},On={class:"__text"},Sn={class:"__icon"},Hn={class:"__dropdown"},Pn={class:"item --header"},jn=["onClick"],Tn=b(Nn,[["render",function(e,n,t,o,s,r){const u=(0,i.up)("i-arrow");return(0,i.wg)(),(0,i.iD)("div",{ref:"el",class:(0,a.C_)(["baklava-select",{"--open":e.open}]),title:e.intf.name,onClick:n[0]||(n[0]=n=>e.open=!e.open)},[(0,i._)("div",Dn,[(0,i._)("div",On,(0,a.zw)(e.selectedText),1),(0,i._)("div",Sn,[(0,i.Wm)(u)])]),(0,i.Wm)(l.uT,{name:"slide-fade"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i._)("div",Hn,[(0,i._)("div",Pn,(0,a.zw)(e.intf.name),1),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.intf.items,((n,t)=>((0,i.wg)(),(0,i.iD)("div",{key:t,class:(0,a.C_)(["item",{"--active":n===e.selectedItem}]),onClick:t=>e.setSelected(n)},(0,a.zw)("string"==typeof n?n:n.text),11,jn)))),128))],512),[[l.F8,e.open]])])),_:1})],10,In)}]]);class Fn extends r.I{constructor(e,n,t){super(e,n),this.component=(0,o.Xl)(Tn),this.items=t}}const Vn=(0,i.aZ)({props:{intf:{type:Object,required:!0}},setup(e){const n=(0,o.iH)(null),t=rn((0,o.Vh)(e,"intf")),a=(0,o.iH)(!1),l=(0,o.iH)(!1),s=(0,i.Fl)((()=>Math.min(100,Math.max(0,100*e.intf.value/(e.intf.max-e.intf.min)))));return{...t,el:n,percentage:s,mousedown:()=>{t.editMode.value||(l.value=!0)},mouseup:()=>{t.editMode.value||(a.value||t.enterEditMode(),l.value=!1,a.value=!1)},mousemove:o=>{if(t.editMode.value)return;const i=Math.max(e.intf.min,Math.min(e.intf.max,(e.intf.max-e.intf.min)*(o.offsetX/n.value.clientWidth)+e.intf.min));l.value&&(t.setValue(i),a.value=!0)},mouseleave:o=>{t.editMode.value||(l.value&&(o.offsetX>=n.value.clientWidth?t.setValue(e.intf.max):o.offsetX<=0&&t.setValue(e.intf.min)),l.value=!1,a.value=!1)}}}}),Wn={key:0,class:"__content"},Un={class:"__label"},An={class:"__value"},Ln={key:1,class:"__content"},$n=b(Vn,[["render",function(e,n,t,o,s,r){return(0,i.wg)(),(0,i.iD)("div",{ref:"el",class:(0,a.C_)(["baklava-slider",{"baklava-ignore-mouse":!e.editMode}]),onPointerdown:n[3]||(n[3]=(...n)=>e.mousedown&&e.mousedown(...n)),onPointerup:n[4]||(n[4]=(...n)=>e.mouseup&&e.mouseup(...n)),onPointermove:n[5]||(n[5]=(...n)=>e.mousemove&&e.mousemove(...n)),onPointerleave:n[6]||(n[6]=(...n)=>e.mouseleave&&e.mouseleave(...n))},[(0,i._)("div",{class:"__slider",style:(0,a.j5)({width:e.percentage+"%"})},null,4),e.editMode?((0,i.wg)(),(0,i.iD)("div",Ln,[(0,i.wy)((0,i._)("input",{ref:"inputEl","onUpdate:modelValue":n[0]||(n[0]=n=>e.tempValue=n),type:"number",class:(0,a.C_)(["baklava-input",{"--invalid":e.invalid}]),style:{"text-align":"right"},onBlur:n[1]||(n[1]=(...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),onKeydown:n[2]||(n[2]=(0,l.D2)(((...n)=>e.leaveEditMode&&e.leaveEditMode(...n)),["enter"]))},null,34),[[l.nr,e.tempValue]])])):((0,i.wg)(),(0,i.iD)("div",Wn,[(0,i._)("div",Un,(0,a.zw)(e.intf.name),1),(0,i._)("div",An,(0,a.zw)(e.stringRepresentation),1)]))],34)}]]),qn=b((0,i.aZ)({props:{intf:{type:Object,required:!0}}}),[["render",function(e,n,t,o,l,s){return(0,i.wg)(),(0,i.iD)("div",null,(0,a.zw)(e.intf.value),1)}]]);class Bn extends r.I{constructor(e,n){super(e,n),this.component=(0,o.Xl)(qn),this.setPort(!1)}}const zn=(0,i.aZ)({props:{intf:{type:Object,required:!0},modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup:(e,{emit:n})=>({v:(0,i.Fl)({get:()=>e.modelValue,set:e=>{n("update:modelValue",e)}})})}),Rn=["placeholder","title"],Gn=b(zn,[["render",function(e,n,t,o,a,s){return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":n[0]||(n[0]=n=>e.v=n),type:"text",class:"baklava-input",placeholder:e.intf.name,title:e.intf.name},null,8,Rn),[[l.nr,e.v]])])}]]);class Yn extends r.I{constructor(){super(...arguments),this.component=(0,o.Xl)(Gn)}}const Kn="__baklava_SubgraphInputNode",Zn="__baklava_SubgraphOutputNode",Xn=(0,u.h)({type:Kn,title:"Subgraph Input",inputs:{name:()=>new Yn("Name","Input").setPort(!1)},outputs:{placeholder:()=>new r.I("Connection",void 0)},onCreate(){this.graphInterfaceId=Ke()}}),Qn=(0,u.h)({type:Zn,title:"Subgraph Output",inputs:{name:()=>new Yn("Name","Output").setPort(!1),placeholder:()=>new r.I("Connection",void 0)},onCreate(){this.graphInterfaceId=Ke()}});function Jn(e,n,t){if(!n.template)return!1;if((0,s.Ds)(n.template)===t)return!0;const o=e.graphTemplates.find((e=>(0,s.Ds)(e)===t));return!!o&&o.nodes.filter((e=>e.type.startsWith(s.qM))).some((t=>Jn(e,n,t.type)))}const et=(0,i.aZ)({components:{PaletteEntry:qe},setup(){const{viewModel:e}=f(),{x:n,y:t}=function(e={}){const{target:n=F}=e,t=(0,o.iH)(!1),i=(0,o.iH)(e.initialValue||{});Object.assign(i.value,Y,i.value);const a=n=>{t.value=!0,e.pointerTypes&&!e.pointerTypes.includes(n.pointerType)||(i.value=function(e,n,t=!1){return n.reduce(((n,o)=>(o in e&&(t&&void 0===e[o]||(n[o]=e[o])),n)),{})}(n,K,!1))};return n&&(V(n,"pointerdown",a,{passive:!0}),V(n,"pointermove",a,{passive:!0}),V(n,"pointerleave",(()=>t.value=!1),{passive:!0})),l=((e,n)=>{for(var t in n||(n={}))z.call(n,t)&&G(e,t,n[t]);if(B)for(var t of B(n))R.call(n,t)&&G(e,t,n[t]);return e})({},function(e){if(!(0,o.dq)(e))return(0,o.BK)(e);const n=Array.isArray(e.value)?new Array(e.value.length):{};for(const t in e.value)n[t]=(0,o.ZM)((()=>({get:()=>e.value[t],set(n){if(Array.isArray(e.value)){const o=[...e.value];o[t]=n,e.value=o}else{const o=j(P({},e.value),{[t]:n});Object.setPrototypeOf(o,e.value),e.value=o}}})));return n}(i)),$(l,q({isInside:t}));var l}(),{transform:a}=y(),l=(0,i.f3)("editorEl"),s=(0,o.iH)(null),r=(0,i.Fl)((()=>{const n=Array.from(e.value.editor.nodeTypes.entries()),t=new Set(n.map((([,e])=>e.category))),o=[];for(const i of t.values()){let t=n.filter((([,e])=>e.category===i));t=e.value.displayedGraph.template?t.filter((([n])=>!Jn(e.value.editor,e.value.displayedGraph,n))):t.filter((([e])=>![Kn,Zn].includes(e))),t.length>0&&o.push({name:i,nodeTypes:Object.fromEntries(t)})}return o.sort(((e,n)=>"default"===e.name?-1:"default"===n.name||e.name>n.name?1:-1)),o})),u=(0,i.Fl)((()=>{if(!s.value||!(null==l?void 0:l.value))return{};const{left:e,top:o}=l.value.getBoundingClientRect();return{top:t.value-o+"px",left:n.value-e+"px"}}));return{draggedNode:s,categories:r,draggedNodeStyles:u,onDragStart:(i,r)=>{s.value={type:i,nodeInformation:r};const u=()=>{const i=(0,o.qj)(new r.type);e.value.displayedGraph.addNode(i);const d=l.value.getBoundingClientRect(),[c,p]=a(n.value-d.left,t.value-d.top);i.position.x=c,i.position.y=p,s.value=null,document.removeEventListener("pointerup",u)};document.addEventListener("pointerup",u)},mouseX:n,mouseY:t}}}),nt={class:"baklava-node-palette"},tt={key:0},ot=b(et,[["render",function(e,n,t,o,s,r){const u=(0,i.up)("PaletteEntry");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",nt,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.categories,(n=>((0,i.wg)(),(0,i.iD)("section",{key:n.name},["default"!==n.name?((0,i.wg)(),(0,i.iD)("h1",tt,(0,a.zw)(n.name),1)):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.nodeTypes,((n,t)=>((0,i.wg)(),(0,i.j4)(u,{key:t,type:t,title:n.title,onPointerdown:o=>e.onDragStart(t,n)},null,8,["type","title","onPointerdown"])))),128))])))),128))]),(0,i.Wm)(l.uT,{name:"fade"},{default:(0,i.w5)((()=>[e.draggedNode?((0,i.wg)(),(0,i.iD)("div",{key:0,class:"baklava-dragged-node",style:(0,a.j5)(e.draggedNodeStyles)},[(0,i.Wm)(u,{type:e.draggedNode.type,title:e.draggedNode.nodeInformation.title},null,8,["type","title"])],4)):(0,i.kq)("",!0)])),_:1})],64)}]]),it="SAVE_SUBGRAPH",at="CREATE_SUBGRAPH",lt=[Kn,Zn],st="DELETE_NODES",rt="SWITCH_TO_MAIN_GRAPH";class ut{constructor(e,n){this.type=e,"addNode"===e?this.nodeId=n:this.nodeState=n}undo(e){"addNode"===this.type?this.removeNode(e):this.addNode(e)}redo(e){"addNode"===this.type&&this.nodeState?this.addNode(e):"removeNode"===this.type&&this.nodeId&&this.removeNode(e)}addNode(e){const n=e.editor.nodeTypes.get(this.nodeState.type);if(!n)return;const t=new n.type;e.addNode(t),t.load(this.nodeState),this.nodeId=t.id}removeNode(e){const n=e.nodes.find((e=>e.id===this.nodeId));n&&(this.nodeState=n.save(),e.removeNode(n))}}class dt{constructor(e,n){if(this.type=e,"addConnection"===e)this.connectionId=n;else{const e=n;this.connectionState={id:e.id,from:e.from.id,to:e.to.id}}}undo(e){"addConnection"===this.type?this.removeConnection(e):this.addConnection(e)}redo(e){"addConnection"===this.type&&this.connectionState?this.addConnection(e):"removeConnection"===this.type&&this.connectionId&&this.removeConnection(e)}addConnection(e){const n=e.findNodeInterface(this.connectionState.from),t=e.findNodeInterface(this.connectionState.to);n&&t&&e.addConnection(n,t)}removeConnection(e){const n=e.connections.find((e=>e.id===this.connectionId));n&&(this.connectionState={id:n.id,from:n.from.id,to:n.to.id},e.removeConnection(n))}}class ct{constructor(e){if(this.type="transaction",0===e.length)throw new Error("Can't create a transaction with no steps");this.steps=e}undo(e){for(let n=this.steps.length-1;n>=0;n--)this.steps[n].undo(e)}redo(e){for(let n=0;n<this.steps.length;n++)this.steps[n].redo(e)}}const pt="UNDO",vt="REDO",mt="START_TRANSACTION",ft="COMMIT_TRANSACTION",ht="COPY",gt="PASTE",yt="CLEAR_CLIPBOARD",wt="OPEN_SIDEBAR";Symbol.toStringTag;const bt={},xt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},kt=[(0,i._)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i._)("path",{d:"M9 13l-4 -4l4 -4m-4 4h11a4 4 0 0 1 0 8h-1"},null,-1)],_t=b(bt,[["render",function(e,n){return(0,i.wg)(),(0,i.iD)("svg",xt,kt)}]]),Ct={},Mt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Et=[(0,i._)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i._)("path",{d:"M15 13l4 -4l-4 -4m4 4h-11a4 4 0 0 0 0 8h1"},null,-1)],Nt=b(Ct,[["render",function(e,n){return(0,i.wg)(),(0,i.iD)("svg",Mt,Et)}]]),It={},Dt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Ot=[(0,i._)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i._)("line",{x1:"5",y1:"12",x2:"19",y2:"12"},null,-1),(0,i._)("line",{x1:"5",y1:"12",x2:"11",y2:"18"},null,-1),(0,i._)("line",{x1:"5",y1:"12",x2:"11",y2:"6"},null,-1)],St=b(It,[["render",function(e,n){return(0,i.wg)(),(0,i.iD)("svg",Dt,Ot)}]]),Ht={},Pt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},jt=[(0,i._)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i._)("path",{d:"M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2"},null,-1),(0,i._)("rect",{x:"9",y:"3",width:"6",height:"4",rx:"2"},null,-1)],Tt=b(Ht,[["render",function(e,n){return(0,i.wg)(),(0,i.iD)("svg",Pt,jt)}]]),Ft={},Vt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Wt=[(0,i._)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i._)("rect",{x:"8",y:"8",width:"12",height:"12",rx:"2"},null,-1),(0,i._)("path",{d:"M16 8v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2"},null,-1)],Ut=b(Ft,[["render",function(e,n){return(0,i.wg)(),(0,i.iD)("svg",Vt,Wt)}]]),At={},Lt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},$t=[(0,i._)("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"},null,-1),(0,i._)("path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2"},null,-1),(0,i._)("circle",{cx:"12",cy:"14",r:"2"},null,-1),(0,i._)("polyline",{points:"14 4 14 8 8 8 8 4"},null,-1)],qt=b(At,[["render",function(e,n){return(0,i.wg)(),(0,i.iD)("svg",Lt,$t)}]]),Bt={},zt={xmlns:"http://www.w3.org/2000/svg",class:"baklava-icon",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Rt=[(0,i.uE)('<path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 3h4v4h-4z"></path><path d="M3 17h4v4h-4z"></path><path d="M17 17h4v4h-4z"></path><path d="M7 17l5 -4l5 4"></path><line x1="12" y1="7" x2="12" y2="13"></line>',6)],Gt=b(Bt,[["render",function(e,n){return(0,i.wg)(),(0,i.iD)("svg",zt,Rt)}]]),Yt=(0,i.aZ)({props:{command:{type:String,required:!0},title:{type:String,required:!0},icon:{type:Object,required:!1,default:void 0}},setup(){const{viewModel:e}=f();return{viewModel:e}}}),Kt=["disabled","title"],Zt=b(Yt,[["render",function(e,n,t,o,l,s){return(0,i.wg)(),(0,i.iD)("button",{class:"baklava-toolbar-entry baklava-toolbar-button",disabled:!e.viewModel.commandHandler.canExecuteCommand(e.command),title:e.title,onClick:n[0]||(n[0]=n=>e.viewModel.commandHandler.executeCommand(e.command))},[e.icon?((0,i.wg)(),(0,i.j4)((0,i.LL)(e.icon),{key:0})):((0,i.wg)(),(0,i.iD)(i.HY,{key:1},[(0,i.Uk)((0,a.zw)(e.title),1)],64))],8,Kt)}]]),Xt=(0,i.aZ)({components:{ToolbarButton:Zt},setup(){const{viewModel:e}=f();return{isSubgraph:(0,i.Fl)((()=>e.value.displayedGraph!==e.value.editor.graph)),commands:[{command:ht,title:"Copy",icon:Ut},{command:gt,title:"Paste",icon:Tt},{command:pt,title:"Undo",icon:_t},{command:vt,title:"Redo",icon:Nt},{command:at,title:"Create Subgraph",icon:Gt}],subgraphCommands:[{command:it,title:"Save Subgraph",icon:qt},{command:rt,title:"Back to Main Graph",icon:St}]}}}),Qt={class:"baklava-toolbar"},Jt=b(Xt,[["render",function(e,n,t,o,a,l){const s=(0,i.up)("toolbar-button");return(0,i.wg)(),(0,i.iD)("div",Qt,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.commands,(e=>((0,i.wg)(),(0,i.j4)(s,{key:e.command,command:e.command,title:e.title,icon:e.icon},null,8,["command","title","icon"])))),128)),e.isSubgraph?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(e.subgraphCommands,(e=>((0,i.wg)(),(0,i.j4)(s,{key:e.command,command:e.command,title:e.title,icon:e.icon},null,8,["command","title","icon"])))),128)):(0,i.kq)("",!0)])}]]),eo=(0,i.aZ)({components:{Background:x,Node:Me,ConnectionWrapper:Oe,TemporaryConnection:He,Sidebar:Fe,Minimap:Ve,NodePalette:ot,Toolbar:Jt},props:{viewModel:{type:Object,required:!0}},setup(e){const n=Symbol("EditorToken"),t=(0,o.Vh)(e,"viewModel");m=t;const a=(0,o.iH)(null);(0,i.JJ)("editorEl",a);const l=(0,i.Fl)((()=>e.viewModel.displayedGraph.nodes)),s=(0,i.Fl)((()=>e.viewModel.displayedGraph.connections)),r=(0,i.Fl)((()=>e.viewModel.displayedGraph.selectedNodes)),u=function(){const{graph:e}=h();let n=[],t=-1,o={x:0,y:0};const a=g((0,i.Fl)((()=>e.value.panning))),l=(0,i.Fl)((()=>({"transform-origin":"0 0",transform:`scale(${e.value.scaling}) translate(${e.value.panning.x}px, ${e.value.panning.y}px)`}))),s=(n,t,o)=>{const i=[n/e.value.scaling-e.value.panning.x,t/e.value.scaling-e.value.panning.y],a=[n/o-e.value.panning.x,t/o-e.value.panning.y],l=[a[0]-i[0],a[1]-i[1]];e.value.panning.x+=l[0],e.value.panning.y+=l[1],e.value.scaling=o},r=()=>({ax:n[0].clientX,ay:n[0].clientY,bx:n[1].clientX,by:n[1].clientY});return{styles:l,...a,onPointerDown:e=>{if(n.push(e),a.onPointerDown(e),2===n.length){const{ax:e,ay:n,bx:t,by:i}=r();o={x:e+(t-e)/2,y:n+(i-n)/2}}},onPointerMove:i=>{for(let e=0;e<n.length;e++)if(i.pointerId==n[e].pointerId){n[e]=i;break}if(2==n.length){const{ax:n,ay:i,bx:a,by:l}=r(),u=n-a,d=i-l,c=Math.sqrt(u*u+d*d);if(t>0){const n=e.value.scaling*(1+(c-t)/500);s(o.x,o.y,n)}t=c}else a.onPointerMove(i)},onPointerUp:e=>{n=n.filter((n=>n.pointerId!==e.pointerId)),t=-1,a.onPointerUp()},onMouseWheel:n=>{n.preventDefault();let t=n.deltaY;1===n.deltaMode&&(t*=32);const o=e.value.scaling*(1-t/3e3);s(n.offsetX,n.offsetY,o)}}}(),d=function(){const{graph:e}=h(),n=(0,o.iH)(null),t=(0,o.iH)(null);return(0,i.JJ)("hoveredOver",(o=>{if(t.value=o??null,o&&n.value){n.value.to=o;const t=e.value.checkConnection(n.value.from,n.value.to);if(n.value.status=t.connectionAllowed?w.ALLOWED:w.FORBIDDEN,t.connectionAllowed){const n=t.connectionsInDanger.map((e=>e.id));e.value.connections.forEach((e=>{n.includes(e.id)&&(e.isInDanger=!0)}))}}else!o&&n.value&&(n.value.to=void 0,n.value.status=w.NONE,e.value.connections.forEach((e=>{e.isInDanger=!1})))})),{temporaryConnection:n,onMouseMove:t=>{n.value&&(n.value.mx=t.offsetX/e.value.scaling-e.value.panning.x,n.value.my=t.offsetY/e.value.scaling-e.value.panning.y)},onMouseDown:()=>{if(t.value){const o=e.value.connections.find((e=>e.to===t.value));t.value.isInput&&o?(n.value={status:w.NONE,from:o.from},e.value.removeConnection(o)):n.value={status:w.NONE,from:t.value},n.value.mx=void 0,n.value.my=void 0}},onMouseUp:()=>{n.value&&t.value&&e.value.addConnection(n.value.from,n.value.to),n.value=null}}}(),c=(0,i.Fl)((()=>({...u.styles.value}))),p=(0,o.iH)(0);e.viewModel.editor.hooks.load.subscribe(n,(e=>(p.value++,e)));const v=()=>{e.viewModel.displayedGraph.selectedNodes=[]};return{el:a,counter:p,nodes:l,connections:s,selectedNodes:r,nodeContainerStyle:c,onPointerMove:e=>{u.onPointerMove(e),d.onMouseMove(e)},onPointerDown:e=>{0===e.button&&(e.target===a.value&&(v(),u.onPointerDown(e)),d.onMouseDown())},onPointerUp:e=>{u.onPointerUp(e),d.onMouseUp()},keyDown:n=>{"Tab"===n.key&&n.preventDefault(),e.viewModel.commandHandler.handleKeyDown(n)},keyUp:n=>{e.viewModel.commandHandler.handleKeyUp(n)},selectNode:n=>{e.viewModel.commandHandler.pressedKeys.includes("Control")||v(),e.viewModel.displayedGraph.selectedNodes.push(n)},temporaryConnection:d.temporaryConnection,mouseWheel:u.onMouseWheel,dragging:u.dragging}}}),no={class:"connections-container"},to=b(eo,[["render",function(e,n,t,o,s,r){const u=(0,i.up)("background"),d=(0,i.up)("toolbar"),c=(0,i.up)("node-palette"),p=(0,i.up)("connection-wrapper"),v=(0,i.up)("temporary-connection"),m=(0,i.up)("node"),f=(0,i.up)("sidebar"),h=(0,i.up)("minimap");return(0,i.wg)(),(0,i.iD)("div",{ref:"el",tabindex:"-1",class:(0,a.C_)(["baklava-editor",{"baklava-ignore-mouse":!!e.temporaryConnection||e.dragging,"--temporary-connection":!!e.temporaryConnection}]),onPointermove:n[0]||(n[0]=(0,l.iM)(((...n)=>e.onPointerMove&&e.onPointerMove(...n)),["self"])),onPointerdown:n[1]||(n[1]=(...n)=>e.onPointerDown&&e.onPointerDown(...n)),onPointerup:n[2]||(n[2]=(...n)=>e.onPointerUp&&e.onPointerUp(...n)),onWheel:n[3]||(n[3]=(0,l.iM)(((...n)=>e.mouseWheel&&e.mouseWheel(...n)),["self"])),onKeydown:n[4]||(n[4]=(...n)=>e.keyDown&&e.keyDown(...n)),onKeyup:n[5]||(n[5]=(...n)=>e.keyUp&&e.keyUp(...n))},[(0,i.WI)(e.$slots,"background",{},(()=>[(0,i.Wm)(u)])),(0,i.WI)(e.$slots,"toolbar",{},(()=>[(0,i.Wm)(d)])),(0,i.WI)(e.$slots,"palette",{},(()=>[(0,i.Wm)(c)])),((0,i.wg)(),(0,i.iD)("svg",no,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.connections,(n=>((0,i.wg)(),(0,i.iD)("g",{key:n.id+e.counter.toString()},[(0,i.WI)(e.$slots,"connection",{connection:n},(()=>[(0,i.Wm)(p,{connection:n},null,8,["connection"])]))])))),128)),(0,i.WI)(e.$slots,"temporaryConnection",{temporaryConnection:e.temporaryConnection},(()=>[e.temporaryConnection?((0,i.wg)(),(0,i.j4)(v,{key:0,connection:e.temporaryConnection},null,8,["connection"])):(0,i.kq)("",!0)]))])),(0,i._)("div",{class:"node-container",style:(0,a.j5)(e.nodeContainerStyle)},[(0,i.Wm)(l.W3,{name:"fade"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.nodes,(n=>(0,i.WI)(e.$slots,"node",{node:n,selected:e.selectedNodes.includes(n),onSelect:t=>e.selectNode(n)},(()=>[((0,i.wg)(),(0,i.j4)(m,{key:n.id+e.counter.toString(),node:n,selected:e.selectedNodes.includes(n),onSelect:t=>e.selectNode(n)},null,8,["node","selected","onSelect"]))])))),256))])),_:3})],4),(0,i.WI)(e.$slots,"sidebar",{},(()=>[(0,i.Wm)(f)])),(0,i.WI)(e.$slots,"minimap",{},(()=>[e.viewModel.settings.enableMinimap?((0,i.wg)(),(0,i.j4)(h,{key:0})):(0,i.kq)("",!0)]))],34)}]]),oo=()=>{const e=(0,o.iH)(new Map),n=(n,t=!1,...o)=>{if(e.value.has(n))return e.value.get(n).execute(...o);if(t)throw new Error(`[CommandHandler] Command ${n} not registered`)},t=function(e){const n=(0,o.iH)([]),t=(0,o.iH)([]);return{pressedKeys:n,handleKeyDown:o=>{n.value.includes(o.key)||n.value.push(o.key),t.value.forEach((t=>{t.keys.every((e=>n.value.includes(e)))&&e(t.commandName)}))},handleKeyUp:e=>{const t=n.value.indexOf(e.key);t>=0&&n.value.splice(t,1)},registerHotkey:(e,n)=>{t.value.push({keys:e,commandName:n})}}}(n);return(0,o.qj)({registerCommand:(n,t)=>{if(e.value.has(n))throw new Error(`Command "${n}" already exists`);e.value.set(n,t)},executeCommand:n,canExecuteCommand:(n,t=!1,...o)=>{if(!e.value.has(n)){if(t)throw new Error(`[CommandHandler] Command ${n} not registered`);return!1}return e.value.get(n).canExecute(o)},...t})},io=e=>!(e instanceof c.k);function ao(e){const n=(0,o.iH)(e??new p.M),t=Symbol("ViewModelToken"),a=(0,o.iH)(null),l=(0,o.YS)(a),{switchGraph:r}=function(e,n){return{switchGraph:t=>{let o;if(io(t))o=new c.k(e.value),t.createGraph(o),o.inputs.forEach((e=>{const n=new Xn;n.inputs.name.value=e.name,n.graphInterfaceId=e.id,o.addNode(n);const t=o.findNodeInterface(e.nodeInterfaceId);t?o.addConnection(n.outputs.placeholder,t):console.warn(`Could not find target interface ${e.nodeInterfaceId} for subgraph input node`)})),o.outputs.forEach((e=>{const n=new Qn;n.inputs.name.value=e.name,n.graphInterfaceId=e.id,o.addNode(n);const t=o.findNodeInterface(e.nodeInterfaceId);t?o.addConnection(t,n.inputs.placeholder):console.warn(`Could not find target interface ${e.nodeInterfaceId} for subgraph input node`)}));else{if(t!==e.value.graph)throw new Error("Can only switch using 'Graph' instance when it is the root graph. Otherwise a 'GraphTemplate' must be used.");o=t}n.value&&n.value!==e.value.graph&&n.value.destroy(),o.panning=o.panning??t.panning??{x:0,y:0},o.scaling=o.scaling??t.scaling??1,o.selectedNodes=o.selectedNodes??[],o.sidebar=o.sidebar??{visible:!1,nodeId:"",optionName:""},n.value=o}}}(n,a),u=(0,i.Fl)((()=>l.value&&l.value!==n.value.graph)),m=(0,o.qj)({useStraightConnections:!1,enableMinimap:!1,background:{gridSize:100,gridDivision:5,subGridVisibleThreshold:.6}}),f=oo(),h=function(e,n){const t=Symbol("HistoryToken"),a=(0,o.iH)(200),l=(0,o.iH)([]),s=(0,o.iH)(!1),r=(0,o.iH)(-1),u=(0,o.iH)(!1),d=(0,o.iH)([]),c=e=>{if(!s.value)if(u.value)d.value.push(e);else for(r.value!==l.value.length-1&&(l.value=l.value.slice(0,r.value+1)),l.value.push(e),r.value++;l.value.length>a.value;)l.value.shift()},p=()=>0!==l.value.length&&-1!==r.value,v=()=>0!==l.value.length&&r.value<l.value.length-1;return(0,i.YP)(e,((e,n)=>{n&&(n.events.addNode.unsubscribe(t),n.events.removeNode.unsubscribe(t),n.events.addConnection.unsubscribe(t),n.events.removeConnection.unsubscribe(t)),e&&(e.events.addNode.subscribe(t,(e=>{c(new ut("addNode",e.id))})),e.events.removeNode.subscribe(t,(e=>{c(new ut("removeNode",e.save()))})),e.events.addConnection.subscribe(t,(e=>{c(new dt("addConnection",e.id))})),e.events.removeConnection.subscribe(t,(e=>{c(new dt("removeConnection",e))})))}),{immediate:!0}),n.registerCommand(pt,{canExecute:p,execute:()=>{p()&&(s.value=!0,l.value[r.value--].undo(e.value),s.value=!1)}}),n.registerCommand(vt,{canExecute:v,execute:()=>{v()&&(s.value=!0,l.value[++r.value].redo(e.value),s.value=!1)}}),n.registerCommand(mt,{canExecute:()=>!u.value,execute:()=>{u.value=!0}}),n.registerCommand(ft,{canExecute:()=>u.value,execute:()=>{u.value=!1,d.value.length>0&&(c(new ct(d.value)),d.value=[])}}),n.registerHotkey(["Control","z"],pt),n.registerHotkey(["Control","y"],vt),(0,o.qj)({maxSteps:a})}(l,f),g=function(e,n,t){const a=Symbol("ClipboardToken"),l=(0,o.iH)(""),s=(0,o.iH)(""),r=(0,i.Fl)((()=>!l.value)),u=(e,n,t)=>{for(const o of e){let e;if(t&&"input"!==t||(e=Object.values(o.inputs).find((e=>e.id===n))),e||t&&"output"!==t||(e=Object.values(o.outputs).find((e=>e.id===n))),e)return e}};return t.registerCommand(ht,{canExecute:()=>!0,execute:()=>{const n=e.value.selectedNodes.flatMap((e=>[...Object.values(e.inputs),...Object.values(e.outputs)])),t=e.value.connections.filter((e=>n.includes(e.from)||n.includes(e.to))).map((e=>({from:e.from.id,to:e.to.id})));s.value=JSON.stringify(t),l.value=JSON.stringify(e.value.selectedNodes.map((e=>e.save())))}}),t.registerHotkey(["Control","c"],ht),t.registerCommand(gt,{canExecute:()=>!r.value,execute:()=>{if(r.value)return;const o=new Map,i=JSON.parse(l.value),d=JSON.parse(s.value),c=[],p=[],v=e.value;t.executeCommand(mt);for(const e of i){const t=n.value.nodeTypes.get(e.type);if(!t)return void console.warn(`Node type ${e.type} not registered`);const i=new t.type,l=i.id;c.push(i);const s=e=>{Object.values(e).forEach((e=>{e.hooks.load.subscribe(a,(n=>{const t=Ke();return o.set(n.id,t),e.id=t,e.hooks.load.unsubscribe(a),n}))}))};s(i.inputs),s(i.outputs),i.hooks.beforeLoad.subscribe(a,(e=>{const n=e;return n.position&&(n.position.x+=10,n.position.y+=10),i.hooks.beforeLoad.unsubscribe(a),n})),v.addNode(i),i.load(e),i.id=l,o.set(e.id,l)}for(const e of d){const n=u(c,o.get(e.from),"output"),t=u(c,o.get(e.to),"input");if(!n||!t)continue;const i=v.addConnection(n,t);i&&p.push(i)}return t.executeCommand(ft),{newNodes:c,newConnections:p}}}),t.registerHotkey(["Control","v"],gt),t.registerCommand(yt,{canExecute:()=>!0,execute:()=>{l.value="",s.value=""}}),(0,o.qj)({isEmpty:r})}(l,n,f),y={renderNode:new v.p$(null),renderInterface:new v.p$(null)};return function(e,n,t){!function(e,n){n.registerCommand(st,{canExecute:()=>e.value.selectedNodes.length>0,execute(){e.value.selectedNodes.forEach((n=>e.value.removeNode(n)))}}),n.registerHotkey(["Delete"],st)}(e,n),function(e,n,t){n.registerCommand(at,{canExecute:()=>e.value.selectedNodes.filter((e=>!lt.includes(e.type))).length>0,execute:()=>{const i=e.value,a=e.value.editor;if(0===i.selectedNodes.length)return;const l=i.selectedNodes.filter((e=>!lt.includes(e.type))),r=l.flatMap((e=>Object.values(e.inputs))),u=l.flatMap((e=>Object.values(e.outputs))),c=i.connections.filter((e=>!u.includes(e.from)&&r.includes(e.to))),p=i.connections.filter((e=>u.includes(e.from)&&!r.includes(e.to))),v=i.connections.filter((e=>u.includes(e.from)&&r.includes(e.to))),m=c.map((e=>e.to)),f=p.map((e=>e.from)),h=new Map,g=[];for(const e of m){const n=Ke();h.set(e.id,n),g.push({id:n,nodeInterfaceId:e.id,name:e.name})}const y=[];for(const e of f){const n=Ke();h.set(e.id,n),y.push({id:n,nodeInterfaceId:e.id,name:e.name})}const w=(0,o.qj)(new d.o({connections:v.map((e=>({id:e.id,from:e.from.id,to:e.to.id}))),inputs:g,outputs:y,nodes:l.map((e=>e.save()))},a));a.addGraphTemplate(w);const b=a.nodeTypes.get((0,s.Ds)(w));if(!b)throw new Error("Unable to create subgraph: Could not find corresponding graph node type");const x=(0,o.qj)(new b.type);i.addNode(x);const k=Math.round(l.map((e=>e.position.x)).reduce(((e,n)=>e+n),0)/l.length),_=Math.round(l.map((e=>e.position.y)).reduce(((e,n)=>e+n),0)/l.length);x.position.x=k,x.position.y=_,c.forEach((e=>{i.removeConnection(e),i.addConnection(e.from,x.inputs[h.get(e.to.id)])})),p.forEach((e=>{i.removeConnection(e),i.addConnection(x.outputs[h.get(e.from.id)],e.to)})),l.forEach((e=>i.removeNode(e))),n.canExecuteCommand(it)&&n.executeCommand(it),t(w),e.value.panning={...i.panning},e.value.scaling=i.scaling}})}(e,n,t),function(e,n){n.registerCommand(it,{canExecute:()=>{var n;return e.value!==(null==(n=e.value.editor)?void 0:n.graph)},execute:()=>{const n=e.value;if(!n.template)throw new Error("Graph template property not set");const t=[],o=[],i=n.nodes.filter((e=>e.type===Kn));for(const e of i){const i=n.connections.filter((n=>n.from===e.outputs.placeholder));i.forEach((n=>{o.push({id:e.graphInterfaceId,name:e.inputs.name.value,nodeInterfaceId:n.to.id})})),t.push(...i)}const a=[],l=n.nodes.filter((e=>e.type===Zn));for(const e of l){const o=n.connections.filter((n=>n.to===e.inputs.placeholder));o.forEach((n=>{a.push({id:e.graphInterfaceId,name:e.inputs.name.value,nodeInterfaceId:n.from.id})})),t.push(...o)}const s=n.connections.filter((e=>!t.includes(e))),r=n.nodes.filter((e=>e.type!==Kn&&e.type!==Zn));n.template.update({inputs:o,outputs:a,connections:s.map((e=>({id:e.id,from:e.from.id,to:e.to.id}))),nodes:r.map((e=>e.save()))}),n.template.panning=n.panning,n.template.scaling=n.scaling}})}(e,n),function(e,n,t){n.registerCommand(rt,{canExecute:()=>e.value!==e.value.editor.graph,execute:()=>{n.executeCommand(it),t(e.value.editor.graph)}})}(e,n,t)}(l,f,r),function(e,n){!function(e,n){n.registerCommand(wt,{execute:n=>{e.value.sidebar.nodeId=n,e.value.sidebar.visible=!0},canExecute:()=>!0})}(e,n)}(l,f),(0,i.YP)(n,((e,o)=>{o&&(o.events.registerGraph.unsubscribe(t),o.graphEvents.beforeAddNode.unsubscribe(t),e.nodeHooks.beforeLoad.unsubscribe(t),e.nodeHooks.afterSave.unsubscribe(t),e.graphTemplateHooks.beforeLoad.unsubscribe(t),e.graphTemplateHooks.afterSave.unsubscribe(t)),e&&(e.nodeHooks.beforeLoad.subscribe(t,((e,n)=>(n.position=e.position??{x:0,y:0},n.width=e.width??200,n.twoColumn=e.twoColumn??!1,e))),e.nodeHooks.afterSave.subscribe(t,((e,n)=>(e.position=n.position,e.width=n.width,e.twoColumn=n.twoColumn,e))),e.graphTemplateHooks.beforeLoad.subscribe(t,((e,n)=>(n.panning=e.panning,n.scaling=e.scaling,e))),e.graphTemplateHooks.afterSave.subscribe(t,((e,n)=>(e.panning=n.panning,e.scaling=n.scaling,e))),e.graphEvents.beforeAddNode.subscribe(t,(e=>function(e){e.position=e.position??{x:0,y:0},e.disablePointerEvents=!1,e.twoColumn=e.twoColumn??!1,e.width=e.width??200}(e))),n.value.registerNodeType(Xn,{category:"Subgraphs"}),n.value.registerNodeType(Qn,{category:"Subgraphs"}),r(e.graph))}),{immediate:!0}),(0,o.qj)({editor:n,displayedGraph:l,isSubgraph:u,settings:m,commandHandler:f,history:h,clipboard:g,hooks:y,switchGraph:r})}const lo=Object.freeze(Object.defineProperty({__proto__:null,Connection:Ie,ConnectionWrapper:Oe,TemporaryConnection:He,Node:Me,NodeInterface:he,ContextMenu:re,Minimap:Ve,Sidebar:Fe},Symbol.toStringTag,{value:"Module"}))}}]);
//# sourceMappingURL=114.1887e3ae.js.map