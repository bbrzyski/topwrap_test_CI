(self.webpackChunkpipeline_manager=self.webpackChunkpipeline_manager||[]).push([[231],{62902:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(2262),i=n(66252),a=n(3823),s=n(16478);function r(e,t=void 0,n=void 0){const{graph:r}=(0,a.n4)(),{viewModel:l}=(0,a.Dz)(),d=null!=t?t:(0,s.G)((0,o.iH)(1)),c=(0,i.Fl)((()=>l.value.settings.background.gridSize)),u=(0,s.G)(c),p={x:(0,s.n)("x"),y:(0,s.n)("y")},h=(0,o.iH)(null),v=(0,o.iH)(null),g=(0,o.iH)(!0),f=(0,i.Fl)((()=>!(!h.value||!v.value||v.value.x===e.value.x&&v.value.y===e.value.y))),m=(e,t,o=!1,i=!1)=>{if(o&&void 0!==n){const o=p[t](e,n,r.value.selectedNodes.map((e=>e.id)));if(void 0!==o)return o}return i?u(e):g.value?d(e):e};return e.value&&(e.value.x=m(e.value.x,"x"),e.value.y=m(e.value.y,"y")),{dragging:f,onPointerDown:t=>{g.value=!t.shiftKey,h.value={x:t.pageX,y:t.pageY},v.value={x:e.value.x,y:e.value.y}},onPointerMove:t=>{g.value=!t.shiftKey;const n=t.ctrlKey,o=t.shiftKey;if(h.value&&v.value){const i=t.pageX-h.value.x,a=t.pageY-h.value.y;e.value.x=m(v.value.x+i/r.value.scaling,"x",n,o),e.value.y=m(v.value.y+a/r.value.scaling,"y",n,o)}},onPointerUp:()=>{h.value=null,v.value=null,g.value=!0}}}},68441:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var o=n(66252),i=n(3577),a=n(49963);const s=["id"],r={key:2};var l=n(2262),d=n(3823),c=n(53742),u=n(16517);const p=(0,o.aZ)({extends:d.z8.NodeInterface,props:{highlighted:Boolean,picked:Boolean,switchSides:{},toggleGroup:{default:()=>{},required:!1},tabindexValue:{default:-1,required:!1}},components:{Arrow:c.Z},setup(e){const{el:t,isConnected:n,showComponent:i,startHover:a,endHover:s,openSidebar:r}=d.z8.NodeInterface.setup(e),{viewModel:c}=(0,d.Dz)(),{graph:p}=(0,d.n4)();e.intf.events.beforeSetValue.unsubscribe(e.intf),e.intf.events.beforeSetValue.subscribe(e.intf,((e,t)=>{c.value.editor.readonly&&t()})),e.intf.group&&(e.toggleGroup(e.intf),e.intf.events.setValue.unsubscribe(e.intf),e.intf.events.setValue.subscribe(e.intf,(()=>e.toggleGroup(e.intf))));const h=(0,l.iH)(!1),v=(0,u.Z)(700,(()=>{c.value.editor.readonly||(e.switchSides(e.intf),s())})),g=e.intf.port&&"inout"!==e.intf.direction,f=(0,o.Fl)((()=>{if("input"===e.intf.direction){if("left"===e.intf.side)return"right";if("right"===e.intf.side)return"down"}if("output"===e.intf.direction){if("left"===e.intf.side)return"down";if("right"===e.intf.side)return"right"}return"down"})),m=(0,o.Fl)((()=>({"--input":"left"===e.intf.side,"--output":"right"===e.intf.side,"--connected":n.value,__readonly:c.value.editor.readonly}))),y=(0,o.Fl)((()=>void 0!==e.intf.externalName));new d._N("External name",e.intf.externalName).setPort(!1).componentName="TextInterface";const w=(0,l.iH)(!1),b=(0,l.iH)(!1),_=(0,l.iH)(null),k=[],E=(0,l.iH)(e.intf.externalName);return{arrowRotation:f,displayArrow:g,editExternalName:w,el:t,enableExternalNameEdit:t=>{k.splice(0,k.length),k.push(...p.value.obtainExposedNames()),k.splice(k.indexOf(e.intf.externalName),1),w.value=!0,t.preventDefault(),(0,o.Y3)().then((()=>{_.value.focus(),_.value.select(),b.value=p.value.isIncorrectExternalName(e.intf.externalName,k)}))},endHover:s,endHoverWrapper:()=>{h.value=!1,c.value.editor.readonly||s()},externalNameInput:_,externalNameInputIncorrect:b,externalNameInputCallback:e=>{b.value=p.value.isIncorrectExternalName(e.target.value,k)},externalNameFocusOutCallback:()=>{w.value=!1,b.value=!1;const t=p.value.resolveNewExposedName(E.value);E.value=t,c.value.editor.exposeInterface(p.value.id,e.intf,t)},hovered:h,isConnected:n,inputExternalName:E,newClasses:m,onMouseDown:v,openSidebar:r,showComponent:i,isExposed:y,startHover:a,startHoverWrapper:()=>{h.value=!0,c.value.editor.readonly||a()}}}}),h=(0,n(83744).Z)(p,[["render",function(e,t,n,l,d,c){const u=(0,o.up)("Arrow");return(0,o.wg)(),(0,o.iD)("div",{id:e.intf.id,ref:"el",class:(0,i.C_)(["baklava-node-interface",e.newClasses])},[e.intf.port?((0,o.wg)(),(0,o.iD)("div",{key:0,class:(0,i.C_)(["__port",{greyedout_arrow:e.highlighted,picked:e.picked,__square:e.isExposed}]),onMouseenter:t[8]||(t[8]=(...t)=>e.startHoverWrapper&&e.startHoverWrapper(...t)),onMouseleave:t[9]||(t[9]=(...t)=>e.endHoverWrapper&&e.endHoverWrapper(...t)),onPointerdown:t[10]||(t[10]=(0,a.iM)(((...t)=>e.onMouseDown&&e.onMouseDown(...t)),["left"]))},[e.isExposed&&(e.hovered||e.editExternalName)?((0,o.wg)(),(0,o.iD)("div",{key:0,class:(0,i.C_)({__port_name_left:"left"===e.intf.side,__port_name_right:"right"===e.intf.side})},[e.editExternalName?(0,o.wy)(((0,o.wg)(),(0,o.iD)("input",{key:0,"onUpdate:modelValue":t[0]||(t[0]=t=>e.inputExternalName=t),ref:"externalNameInput",type:"text",spellcheck:"false",autocomplete:"off",class:(0,i.C_)(["__port_input",{__error:e.externalNameInputIncorrect}]),placeholder:"External name",onFocusout:t[1]||(t[1]=(...t)=>e.externalNameFocusOutCallback&&e.externalNameFocusOutCallback(...t)),onKeydown:[t[2]||(t[2]=(0,a.D2)((0,a.iM)((e=>{e.target.blur()}),["exact","stop"]),["enter"])),t[5]||(t[5]=(0,a.iM)((e=>e.stopPropagation()),["ctrl","stop"]))],onInput:t[3]||(t[3]=(...t)=>e.externalNameInputCallback&&e.externalNameInputCallback(...t)),onPointerdown:t[4]||(t[4]=(0,a.iM)((e=>e.stopPropagation()),["left","stop"]))},null,34)),[[a.nr,e.inputExternalName]]):((0,o.wg)(),(0,o.iD)("span",{key:1,onPointerdown:t[6]||(t[6]=(0,a.iM)(((...t)=>e.enableExternalNameEdit&&e.enableExternalNameEdit(...t)),["left","stop"])),onKeydown:t[7]||(t[7]=(0,a.iM)((()=>{}),["stop"]))},(0,i.zw)(e.intf.externalName),33))],2)):(0,o.kq)("",!0),e.displayArrow?((0,o.wg)(),(0,o.j4)(u,{key:1,noninteractable:!0,color:"black",scale:"big",rotate:e.arrowRotation},null,8,["rotate"])):(0,o.kq)("",!0)],34)):(0,o.kq)("",!0),e.showComponent?((0,o.wg)(),(0,o.j4)((0,o.LL)(e.intf.component),{key:1,modelValue:e.intf.value,"onUpdate:modelValue":t[11]||(t[11]=t=>e.intf.value=t),node:e.node,intf:e.intf,onKeydown:t[12]||(t[12]=(0,a.iM)((()=>{}),["stop"])),tabindex:e.tabindexValue},null,40,["modelValue","node","intf","tabindex"])):((0,o.wg)(),(0,o.iD)("span",r,(0,i.zw)(e.intf.name),1))],10,s)}]])},35732:(e,t,n)=>{"use strict";n.d(t,{Z:()=>V});var o=n(66252),i=n(49963),a=n(3577);const s=e=>((0,o.dD)("data-v-1fe64c2d"),e=e(),(0,o.Cn)(),e),r={key:0,class:"__content"},l={class:"__header"},d=["src"],c={class:"__node-name"},u=["href","onPointerover"],p=["src","alt"],h={class:"__category"},v=s((()=>(0,o._)("div",{class:"__title"},"Category",-1))),g={class:"__category-name"},f={key:0,class:"__replace"},m={key:0,class:"__replace_entry"},y=s((()=>(0,o._)("div",{class:"__replace_title"},"Generalize:",-1))),w={key:1,class:"__replace_entry"},b=s((()=>(0,o._)("div",{class:"__replace_title"},"Specialize:",-1))),_={key:2,class:"__replace_entry"},k=s((()=>(0,o._)("div",{class:"__replace_title"},"Choose other type:",-1))),E={key:1,class:"__properties"},x=s((()=>(0,o._)("div",{class:"__title"},"Properties",-1))),C={class:"__property-name"},N=s((()=>(0,o._)("div",{class:"__title"}," Description ",-1))),P={class:"__markdown-content"},D=["innerHTML"],M={key:2,class:"__interface_groups"},S=s((()=>(0,o._)("div",{class:"__title"},"Interface Groups",-1))),I={class:"__group-assign"},T={class:"__error_outputs"},H=s((()=>(0,o._)("div",{class:"__title"},"Conflicts:",-1)));var L=n(2262),O=n(44773),j=n(3823),A=n(53787),F=n.n(A),U=n(68441),Z=n(81904),Y=n(8532),$=n(20196),R=n(60810),G=n(90779);const W=(0,o.aZ)({components:{Cross:Z.Z,CustomInterface:U.Z,CheckboxInterface:j.Ud,Tooltip:Y.Z},emits:["sidebar-open"],setup(e,{emit:t}){const n=$.ZP.getEditorManagerInstance(),i=(0,o.Fl)((()=>n.baklavaView)),a=(0,o.Fl)((()=>i.value.displayedGraph)),s=new(F().Converter)({smartIndentationFix:!0,simpleLineBreaks:!0}),r=(0,L.iH)(300),l=(0,o.Fl)((()=>{const e=a.value.sidebar.nodeId;return a.value.nodes.find((t=>t.id===e))})),d=(0,o.Fl)((()=>a.value.editor.nodeTypes.get(l.value.type).category)),c=(0,o.Fl)((()=>`${d.value.split("/").join(" / ")}`)),u=(0,o.Fl)((()=>{let e=s.makeHtml(l.value?.description??"");return e.match(/<a href="[a-zA-Z0-9-$_.+!*'()/&?=:%]+">/gm)?.forEach((t=>{const n=t.split('"'),o=` tabindex="-1" target="_blank"${n[2]}`,i=[n[0],n[1],o].join('"');e=e.replace(t,i)})),e})),p=(0,o.Fl)((()=>i.value.editor.getNodeIconPath(l.value?.type))),h=(0,o.Fl)((()=>i.value.editor.getNodeURLs(l.value?.type))),v=e=>i.value.cache[`./${e}`]??e,g=(0,o.Fl)((()=>v(p.value))),f=(0,o.Fl)((()=>a.value.sidebar.visible));(0,o.YP)(l,(()=>{void 0===l.value&&(a.value.sidebar.visible=!1)})),(0,o.YP)(f,(e=>{e&&t("sidebar-open")}));const m=(0,L.iH)(null),y=(0,L.iH)(null),w=(0,L.iH)(null);y.value={top:0,left:0,visible:!1,text:""};const b=(0,o.Fl)((()=>({width:`${r.value}px`}))),_=e=>{e.preventDefault(),r.value-=e.movementX},k=(0,o.Fl)((()=>Object.values(l.value.inputs).filter((e=>!e.hidden)))),E=(0,o.Fl)((()=>Object.values(k.value).filter((e=>!e.port)))),x=(0,o.Fl)((()=>Object.values({...l.value.inputs,...l.value.outputs}).filter((e=>void 0!==e.interfaces)))),C=(0,L.iH)(""),N=(0,o.Fl)((()=>({"--disabled":""!==C.value}))),P=(0,o.Fl)((()=>{const e=(0,L.iH)([]);return a.value.sidebar.visible,x.value.forEach((t=>{const n=new j.Ud(t.name,!t.hidden).setPort(!1);n.events.setValue.subscribe(this,(()=>{const e=(0,R.dw)(D.value,l.value.inputs,l.value.outputs);e.length?C.value=e.map((([e,t,n])=>`Reused ${t} - ${e} for interface group ${n}`)):C.value=""})),n.componentName="CheckboxInterface",n.intfG=t,e.value.push(n)})),e.value})),D=(0,o.Fl)((()=>{const e=[];return P.value.forEach((t=>{t.value&&e.push(`${t.intfG.direction}_${t.intfG.name}`)})),e})),M=(0,o.Fl)((()=>{const e=new j.Sd("Assign",(()=>{P.value.forEach((e=>{l.value.toggleInterfaceGroup(e.intfG,e.value)})),C.value=""}));return e.componentName="ButtonInterface",e})),S=e=>{const t=(0,L.iH)([]);return(e??[]).forEach((e=>{const n=new j.Sd(e,(()=>{const t=a.value.replaceNode(l.value,e);a.value.sidebar.nodeId=t.id}));n.componentName="ButtonInterface",t.value.push(n)})),t.value},I=(0,o.Fl)((()=>S(l.value.extends))),T=(0,o.Fl)((()=>S(l.value.extending))),H=(0,o.Fl)((()=>S(l.value.siblings))),A=(0,o.Fl)((()=>""===l.value.title||void 0===l.value.title?l.value.type.startsWith(O.qM)?l.value.type.slice(O.qM.length):l.value.type:l.value.title));return{graph:a,node:l,styles:b,startResize:()=>{r.value=w.value.offsetWidth,window.addEventListener("mousemove",_),window.addEventListener("mouseup",(e=>{e.preventDefault(),window.removeEventListener("mousemove",_)}),{once:!0})},close:()=>{a.value.sidebar.visible=!1},displayedProperties:E,interfaceGroups:x,interfaceGroupsCheckboxes:P,interfaceGroupsButton:M,interfaceGroupsOutput:C,interfaceGroupsButtonClasses:N,nodeIconPath:g,nodeURLs:h,getIconPath:v,desc:u,tooltip:y,onPointerOver:(e,t)=>{y.value.text=e,y.value.visible=!0,(0,o.Y3)().then((()=>{const e=t.clientX-t.offsetX+t.currentTarget.offsetWidth/2+m.value.$el.clientWidth;y.value.top=t.clientY-t.offsetY+t.currentTarget.offsetHeight,e>window.innerWidth?y.value.left=t.clientX-t.offsetX+t.currentTarget.offsetWidth/2-m.value.$el.clientWidth/2:y.value.left=t.clientX-t.offsetX+t.currentTarget.offsetWidth/2}))},onPointerLeave:()=>{y.value.visible=!1},tooltipRef:m,sidebarRef:w,toggleGroup:e=>{e.group.forEach((t=>{l.value.inputs[t].hidden=e.value}))},getOptionName:G.Dx,prettyCategory:c,replacementParents:I,replacementChildren:T,replacementSiblings:H,editorManager:n,displayedName:A}}}),V=(0,n(83744).Z)(W,[["render",function(e,t,n,s,L,O){const j=(0,o.up)("Tooltip"),A=(0,o.up)("Cross"),F=(0,o.up)("CustomInterface");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.wy)((0,o.Wm)(j,{ref:"tooltipRef",left:e.tooltip.left,top:e.tooltip.top,text:e.tooltip.text},null,8,["left","top","text"]),[[i.F8,e.tooltip.visible]]),(0,o._)("div",{class:(0,a.C_)(["baklava-sidebar prevent-select",{"--open":e.graph.sidebar.visible,"--hidehud":e.editorManager.editor.hideHud,"--preview":e.editorManager.editor.preview,"hidden-navbar":e.$isMobile}]),ref:"sidebarRef",style:(0,a.j5)(e.styles)},[(0,o._)("div",{class:"__resizer",onMousedown:t[0]||(t[0]=(...t)=>e.startResize&&e.startResize(...t))},null,32),e.node?((0,o.wg)(),(0,o.iD)("div",r,[(0,o._)("div",l,[(0,o.Wm)(A,{tabindex:"-1",class:"__close",onClick:e.close},null,8,["onClick"]),void 0!==e.nodeIconPath?((0,o.wg)(),(0,o.iD)("img",{key:0,class:"__node-icon",src:e.nodeIconPath},null,8,d)):(0,o.kq)("",!0),(0,o._)("div",c,(0,a.zw)(e.displayedName),1),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.nodeURLs,(n=>((0,o.wg)(),(0,o.iD)("a",{key:n.name,href:n.url,class:"__url",target:"_blank",draggable:"false",onPointerover:t=>e.onPointerOver(n.name,t),onPointerleave:t[1]||(t[1]=(...t)=>e.onPointerLeave&&e.onPointerLeave(...t)),tabindex:"-1"},[void 0!==n.icon?((0,o.wg)(),(0,o.iD)("img",{key:0,src:e.getIconPath(n.icon),alt:n.name,draggable:"false"},null,8,p)):(0,o.kq)("",!0)],40,u)))),128))]),(0,o._)("div",h,[v,(0,o._)("div",g,(0,a.zw)(e.prettyCategory),1)]),e.editorManager.editor.readonly?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",f,[e.replacementParents.length?((0,o.wg)(),(0,o.iD)("div",m,[y,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.replacementParents,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e,class:"__replace_button"},[((0,o.wg)(),(0,o.j4)((0,o.LL)(e.component),{intf:e,tabindex:"-1"},null,8,["intf"]))])))),128))])):(0,o.kq)("",!0),e.replacementChildren.length?((0,o.wg)(),(0,o.iD)("div",w,[b,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.replacementChildren,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e,class:"__replace_button"},[((0,o.wg)(),(0,o.j4)((0,o.LL)(e.component),{intf:e,tabindex:"-1"},null,8,["intf"]))])))),128))])):(0,o.kq)("",!0),e.replacementSiblings.length?((0,o.wg)(),(0,o.iD)("div",_,[k,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.replacementSiblings,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e,class:"__replace_button"},[((0,o.wg)(),(0,o.j4)((0,o.LL)(e.component),{intf:e,tabindex:"-1"},null,8,["intf"]))])))),128))])):(0,o.kq)("",!0)])),e.displayedProperties.length?((0,o.wg)(),(0,o.iD)("div",E,[x,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.displayedProperties,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"__property"},[(0,o._)("div",C,(0,a.zw)(e.getOptionName(t.componentName)?`${t.name}:`:""),1),(0,o.Wm)(F,{node:e.node,intf:t,toggleGroup:e.toggleGroup,tabindex:"-1"},null,8,["node","intf","toggleGroup"])])))),128))])):(0,o.kq)("",!0),(0,o.wy)((0,o._)("div",null,[N,(0,o._)("div",P,[(0,o._)("span",{innerHTML:e.desc,class:"node_description"},null,8,D)])],512),[[i.F8,e.desc]]),e.interfaceGroupsCheckboxes.length>0&&!e.editorManager.editor.readonly?((0,o.wg)(),(0,o.iD)("div",M,[S,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.interfaceGroupsCheckboxes,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"__group"},[((0,o.wg)(),(0,o.j4)((0,o.LL)(e.component),{intf:e},null,8,["intf"]))])))),128)),(0,o._)("div",I,[((0,o.wg)(),(0,o.j4)((0,o.LL)(e.interfaceGroupsButton.component),{intf:e.interfaceGroupsButton,class:(0,a.C_)(e.interfaceGroupsButtonClasses),tabindex:"-1"},null,8,["intf","class"]))])])):(0,o.kq)("",!0),(0,o.wy)((0,o._)("div",T,[H,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.interfaceGroupsOutput,(e=>((0,o.wg)(),(0,o.iD)("p",null,(0,a.zw)(e),1)))),256))],512),[[i.F8,e.interfaceGroupsOutput.length]])])):(0,o.kq)("",!0)],6)],64)}],["__scopeId","data-v-1fe64c2d"]])},89373:(e,t,n)=>{"use strict";n.d(t,{Z:()=>ft});var o=n(66252),i=n(3577),a=n(49963);const s={class:"selection-container"};var r=n(44773),l=n(3823),d=n(2262),c=n(87360),u=n.n(c),p=n(62902),h=n(73933),v=n(68441);const g={key:0,class:"readonly item",style:{cursor:"default"}},f=[(0,o._)("div",{class:"text"},[(0,o._)("i",null,"No resources")],-1)],m=["onClick"],y={class:"icon"},w={class:"text"},b=["href","onClick"],_={class:"icon"},k=["src","alt"],E={class:"text"},x=(0,o.aZ)({extends:l.z8.ContextMenu,props:{urls:{required:!1,default:[]}},emits:["update:modelValue","click"],setup(e,t){const{el:n,styles:o,classes:i,itemsWithHoverProperty:a}=l.z8.ContextMenu.setup(e,t),{viewModel:s}=(0,l.Dz)(),r=(0,d.iH)(!0),c=o=>{!0===e.modelValue&&(!1===r.value?(document.elementsFromPoint(o.clientX,o.clientY).includes(n.value)||(window.removeEventListener("wheel",c),window.removeEventListener("pointerdown",c),t.emit("update:modelValue",!1)),r.value=!0):r.value=!1)};return window.addEventListener("wheel",c),window.addEventListener("pointerdown",c),{el:n,styles:o,classes:i,itemsWithHoverProperty:a,onClick:e=>{t.emit("click",e.value),t.emit("update:modelValue",!1)},getIconPath:e=>s.value.cache[`./${e}`]??e}}});var C=n(83744);const N=(0,C.Z)(x,[["render",function(e,t,n,s,r,l){return(0,o.wg)(),(0,o.j4)(a.uT,{name:"slide-fade"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o._)("div",{ref:"el",class:(0,i.C_)(["baklava-context-menu",e.classes]),style:(0,i.j5)(e.styles)},[0===e.itemsWithHoverProperty.length?((0,o.wg)(),(0,o.iD)("div",g,f)):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.itemsWithHoverProperty,((t,n)=>((0,o.wg)(),(0,o.iD)(o.HY,null,[void 0===t.url?((0,o.wg)(),(0,o.iD)("div",{key:`i-${n}`,class:(0,i.C_)(["item",{submenu:!!t.submenu,"--disabled":!!t.disabled}]),onClick:(0,a.iM)((n=>e.onClick(t)),["stop"])},[(0,o._)("div",y,[void 0!==t.icon?((0,o.wg)(),(0,o.j4)((0,o.LL)(t.icon),{key:0})):(0,o.kq)("",!0)]),(0,o._)("div",w,(0,i.zw)(t.label),1)],10,m)):((0,o.wg)(),(0,o.iD)("a",{key:t.name,href:t.url,class:"item",target:"_blank",draggable:"false",onClick:(0,a.iM)((n=>e.onClick(t)),["stop"])},[(0,o._)("div",_,[void 0!==e.getIconPath(t.icon)?((0,o.wg)(),(0,o.iD)("img",{key:0,src:e.getIconPath(t.icon),alt:t.name,draggable:"false"},null,8,k)):(0,o.kq)("",!0)]),(0,o._)("div",E,(0,i.zw)(t.name),1)],8,b)),t.endSection?((0,o.wg)(),(0,o.iD)("hr",{key:`hr-${n}`})):(0,o.kq)("",!0)],64)))),256))],6),[[a.F8,e.modelValue]])])),_:1})}]]);var P=n(16478),D=n(42159),M=n(16517),S=n(90779),I=n(120),T=n(20196),H=n(46174),L=n(5754),O=n(52364),j=n(90991),A=n(37942),F=n(28028);const U=["id","data-node-type"],Z={class:"interface-cursor"},Y=["onPointerdown"],$=["src"],R=["innerHTML"],G=["onKeydown"],W={class:"__content"},V={class:"__properties"},q={key:1,class:"baklava-node-interface --output"},z={key:1,class:"baklava-node-interface --input"},B={__name:"CustomNode",props:{node:h.l,selected:Boolean,greyedOut:Boolean,interfaces:Array},emits:["select"],setup(e,{emit:t}){const n=e,{viewModel:s}=(0,l.Dz)(),{graph:c}=(0,l.n4)(),u=(0,o.Fl)((()=>s.value.movementStep)),h=(0,o.Fl)((()=>({"transform-origin":"0 0",transform:`scale(${1/c.value.scaling})`}))),g=(0,d.iH)(null),f=(0,d.iH)(null),m=(0,d.iH)(!1),y=(0,d.iH)(null),w=(0,d.iH)(""),b=s.value.editor.getNodeURLs(n.node.type),_=!s.value.editor.nodeURLsEmpty(),k=(0,o.Fl)((()=>Object.values(n.node.inputs).filter((e=>!e.hidden)))),E=(0,o.Fl)((()=>Object.values(n.node.outputs).filter((e=>!e.hidden)))),x=T.ZP.getEditorManagerInstance(),C=(0,L.Z)();Object.entries(n.node.inputs).forEach((([e,t])=>{if(C.backendAvailable&&e.startsWith("property_")){let e=!0;(0,o.YP)(t,(async t=>{if(e||!x.notifyWhenChanged)return void(e=!1);const o={graph_id:n.node.graphInstance.id,node_id:n.node.id,properties:[]};o.properties.push({id:t.id,new_value:t.value}),await C.notifyAboutChange("properties_on_change",o)}))}}));const B=e=>{C.notifyAboutChange("position_on_change",{graph_id:n.node.graphInstance.id,node_id:n.node.id,position:{x:e.x,y:e.y}})},X=e=>(0,o.YP)(e,(e=>{x.notifyWhenChanged&&B(e)}));if(C.backendAvailable){let e=X(n.node.position);(0,o.YP)((()=>n.node.position),(t=>{e(),B(t),e=X(t)}))}const K=(0,d.iH)(!1),J=(0,d.iH)(0),Q=(0,d.iH)(0),ee=(0,o.Fl)((()=>{const e=[];return e.push({value:"sidebar",label:"Details",icon:D.Z.Sidebar}),s.value.editor.readonly||e.push({value:"rename",label:"Rename",icon:D.Z.Pencil}),n.node.type.startsWith(r.qM)&&e.push({value:"editSubgraph",label:"Edit Subgraph"}),e.length>1&&(e.at(-1).endSection=!0),e.push(...b),s.value.editor.readonly||(e.length>1&&(e.at(-1).endSection=!0),e.push({value:"disconnect",label:"Disconnect",icon:D.Z.Disconnect},{value:"delete",label:"Delete",icon:D.Z.Bin})),e})),te=()=>{const{sidebar:e}=s.value.displayedGraph;e.nodeId=n.node.id,e.visible=!0},ne=async e=>{switch(e){case"delete":(0,I.Yr)(),c.value.selectedNodes.includes(n.node)||c.value.selectedNodes.push(n.node),c.value.selectedNodes.forEach((e=>{(0,S.ZF)(e)})),(0,I._c)();break;case"rename":w.value=n.node.title,m.value=!0,await(0,o.Y3)(),y.value.focus(),y.value.select();break;case"disconnect":{(0,I.Yr)();let e=[...k.value,...E.value];c.value.selectedNodes.forEach((t=>{e=e.concat(Object.entries(t.inputs).filter((([e,t])=>!t.hidden&&!e.startsWith("property_"))).map((([,e])=>e)),Object.values(t.outputs).filter((e=>!e.hidden)))})),c.value.connections.filter((t=>void 0!==e.find((e=>e===t.from||e===t.to)))).forEach((e=>{c.value.removeConnection(e)})),(0,I._c)()}break;case"sidebar":te();break;case"editSubgraph":{const e=s.value.editor.switchToSubgraph(n.node);Array.isArray(e)&&e.length&&H.Z.terminalLog("error","Dataflow is invalid",e);break}case"unwrap":(0,I.Yr)(),(0,S.ZF)(n.node,!0),(0,I._c)()}},oe=(0,o.Fl)((()=>0===ee.value.length&&_||ee.value.length>0)),ie=e=>{oe.value&&!1===K.value&&(J.value=e.offsetX,Q.value=e.offsetY,K.value=!0)},ae=function(e,t,n){const{graph:o}=(0,l.n4)(),i=(0,p.Z)(e,n,t),a=i.onPointerMove;return i.onPointerMove=n=>{const i=e.value.x,s=e.value.y;a(n);const r=e.value.x-i,l=e.value.y-s;o.value.selectedNodes.forEach((e=>{e.id!==t&&(e.position.x+=r,e.position.y+=l)}))},i}((0,d.Vh)(n.node,"position"),n.node.id,(0,P.G)(u)),se=(0,o.Fl)((()=>({"--selected":n.selected,"--dragging":ae.dragging.value,"--two-column":!!n.node.twoColumn,"--greyed-out":n.greyedOut,__readonly:s.value.editor.readonly}))),re=(0,o.Fl)((()=>({top:`${n.node.position?.y??0}px`,left:`${n.node.position?.x??0}px`,width:`${n.node.width??200}px`}))),le=(0,o.Fl)((()=>{const e=n.node.highlightedTitle??n.node.title,t=n.node.highlightedType??n.node.type;return n.node.type.startsWith(r.qM)?""===e||void 0===e?n.node.highlightedTitle===n.node.title?t.slice(r.qM.length):t:e:""===e||n.node.title===n.node.type?t:`${e} <pre class="subtitle">${t}</pre>`})),de=e=>{t("select",e)};let ce,ue;const pe=()=>{document.removeEventListener("pointermove",ae.onPointerMove),document.removeEventListener("keyboard.escape",ce),document.removeEventListener("pointerup",ue)};ce=()=>{pe()},ue=()=>{ae.onPointerUp(),pe()};const he=()=>{c.value.findNodeById(n.node.id).title=w.value,m.value=!1},ve=()=>{g.value&&s.value.hooks.renderNode.execute({node:n.node,el:g.value})};(0,o.bv)(ve),(0,o.ic)(ve);const ge=(0,M.Z)(700,(()=>{te()})),fe=()=>{const{sidebar:e}=s.value.displayedGraph;e.visible&&(e.nodeId=n.node.id),ge()},me=(0,o.Fl)((()=>Object.values(k.value).filter((e=>!e.port)))),ye=(0,o.Fl)((()=>Object.values([...k.value,...E.value]).filter((e=>"left"===e.side&&e.port)).sort(((e,t)=>e.sidePosition-t.sidePosition)))),we=(0,o.Fl)((()=>Object.values([...k.value,...E.value]).filter((e=>"right"===e.side&&e.port)).sort(((e,t)=>e.sidePosition-t.sidePosition)))),be=e=>{if(!e.length)return[];const t=Math.max(ye.value.at(-1)?.sidePosition??0,we.value.at(-1)?.sidePosition??0);let n=0;const o=[];for(let i=0;i<=t;i+=1)e[n]?.sidePosition===i?(o.push(e[n]),n+=1):o.push(void 0);return o},_e=(0,o.Fl)((()=>be(we.value))),ke=(0,o.Fl)((()=>be(ye.value)));me.value.forEach((e=>{void 0===e.component&&("InputInterface"===e.componentName?e.setComponent((0,d.Xl)(O.Z)):"ListInterface"===e.componentName?e.setComponent((0,d.Xl)(j.Z)):"SliderInterface"===e.componentName?e.setComponent((0,d.Xl)(A.Z)):"HexInterface"===e.componentName&&e.setComponent((0,d.Xl)(F.Z)))}));const Ee=s.value.editor.getNodeIconPath(n.node.type),xe=s.value.cache[`./${Ee}`]??Ee;let Ce,Ne;const Pe=(0,d.iH)(null),De=(0,d.iH)(null),Me=(0,d.iH)({top:"0px",left:"0px",display:"none"}),Se=(0,o.Fl)((()=>s.value.editor.readonly?oe.value?{cursor:"pointer"}:{cursor:"default"}:{cursor:"drag"})),Ie=e=>e===Ne,Te=e=>{let t;"right"===Ne.side?t=De.value:"left"===Ne.side&&(t=Pe.value);let n=[...t.children].findIndex((t=>t.getBoundingClientRect().bottom>e.clientY));Ce=n,-1===n&&(n=t.children.length-1,Ce=t.children.length-1);const o=t.children[n];Me.value={top:o.offsetTop+o.offsetHeight/2-2.5+"px",display:"block"},"right"===Ne.side?Me.value.right="-0.7em":"left"===Ne.side&&(Me.value.left="-0.7em")},He=()=>{(0,S.Vd)(n.node,Ne,Ne.side,Ce,!0),Ne=void 0,Me.value={top:"0px",left:"0px",right:"0px",display:"none"},document.removeEventListener("pointermove",Te),document.removeEventListener("pointerup",He)},Le=(e,t)=>{Ne=e,Te(t),document.addEventListener("pointermove",Te),document.addEventListener("pointerup",He)},Oe=(0,d.iH)(!1),je=(0,d.iH)(0),Ae=(0,d.iH)(0),Fe=()=>{const e=[];if(void 0!==Ne){const t=void 0===Ne.externalName?{value:"SetExternalName",label:"Expose Interface"}:{value:"UnsetExternalName",label:"Privatize Interface"};e.push(t)}return e.push({value:"SpaceUp",label:"Space Up"},{value:"SpaceDown",label:"Space Down"},{value:"MoveUp",label:"Move Up"},{value:"MoveDown",label:"Move Down"}),e},Ue=(0,d.iH)(Fe()),Ze=e=>{switch(e){case"SetExternalName":s.value.editor.exposeInterface(c.value.id,Ne);break;case"UnsetExternalName":s.value.editor.privatizeInterface(c.value.id,Ne);break;case"MoveUp":if(0===Ne.sidePosition){Ne=void 0;break}Ce=Ne.sidePosition-1,He();break;case"MoveDown":Ce=Ne.sidePosition+1,He();break;case"SpaceUp":case"SpaceDown":{const t="right"===Ne.side?_e.value:ke.value,n="SpaceDown"===e?(e,t)=>e>t:(e,t)=>e>=t;Object.values(t).forEach((e=>{void 0!==e&&n(e.sidePosition,Ne.sidePosition)&&(e.sidePosition+=1)}));break}}},Ye=(e,t)=>{s.value.editor.readonly||!1!==Oe.value||(Ne=e,Ue.value=Fe(),"right"===Ne.side?(je.value=t.currentTarget.offsetLeft+162.5,Ae.value=t.currentTarget.offsetTop+12.5):"left"===Ne.side&&(je.value=t.currentTarget.offsetLeft-t.currentTarget.offsetWidth+162.5,Ae.value=t.currentTarget.offsetTop+12.5),Oe.value=!0)};(0,o.YP)(Oe,(()=>{!1===Oe.value&&(Ne=void 0)}));const $e=e=>{e.group.forEach((t=>{n.node.inputs[t].hidden=!e.value}))},Re=e=>{"left"===e.side?(0,S.Vd)(n.node,e,"right"):(0,S.Vd)(n.node,e,"left")};return(t,r)=>{const l=(0,o.Q2)("click-outside"),u=(0,o.Q2)("long-press"),p=(0,o.Q2)("long-press-to-right");return(0,o.wg)(),(0,o.iD)("div",{id:e.node.id,ref_key:"nodeRef",ref:g,class:(0,i.C_)(["baklava-node",(0,d.SU)(se)]),style:(0,i.j5)((0,d.SU)(re)),"data-node-type":e.node.type,onPointerdown:r[5]||(r[5]=(0,a.iM)((e=>de(e)),["left","self"])),oncontextmenu:"return false;"},[(0,o._)("div",Z,[(0,o._)("div",{class:"line",style:(0,i.j5)(Me.value)},null,4)]),(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",{class:"__title",ref_key:"titleRef",ref:f,style:(0,i.j5)((0,d.SU)(Se)),onPointerdown:[(0,a.iM)(fe,["left","exact"]),r[3]||(r[3]=(0,a.iM)((e=>{return t=e,void(s.value.editor.readonly||(e=>{c.value.selectedNodes.includes(n.node)||de(e),ae.onPointerDown(e),document.addEventListener("pointermove",ae.onPointerMove),document.addEventListener("keyboard.escape",ce),document.addEventListener("pointerup",ue)})(t));var t}),["left"])),(0,a.iM)(ie,["right"])]},[void 0!==(0,d.SU)(xe)?((0,o.wg)(),(0,o.iD)("img",{key:0,class:"__title-icon",src:(0,d.SU)(xe)},null,8,$)):(0,o.kq)("",!0),m.value?(0,o.wy)(((0,o.wg)(),(0,o.iD)("input",{key:2,type:"text",class:"baklava-input","onUpdate:modelValue":r[0]||(r[0]=e=>w.value=e),placeholder:"Node Name",ref_key:"renameField",ref:y,onKeydown:(0,a.D2)(he,["enter"])},null,40,G)),[[a.nr,w.value],[l,he]]):((0,o.wg)(),(0,o.iD)("div",{key:1,class:"__title-label",innerHTML:(0,d.SU)(le)},null,8,R)),K.value?((0,o.wg)(),(0,o.j4)(N,{key:3,modelValue:K.value,"onUpdate:modelValue":r[1]||(r[1]=e=>K.value=e),x:J.value,y:Q.value,items:(0,d.SU)(ee),urls:(0,d.SU)(b),style:(0,i.j5)((0,d.SU)(h)),onPointerdown:r[2]||(r[2]=(0,a.iM)((()=>{}),["left","stop"])),onClick:ne},null,8,["modelValue","x","y","items","urls","style"])):(0,o.kq)("",!0)],44,Y)),[[u,ie,"500"]]),(0,o._)("div",W,[(0,o._)("div",V,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,d.SU)(me),(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id},[(0,o.Uk)((0,i.zw)((0,d.SU)(S.Dx)(t.componentName)?`${t.name}:`:"")+" ",1),(0,o.Wm)(v.Z,{node:e.node,intf:t,toggleGroup:$e},null,8,["node","intf"])])))),128))]),(0,o._)("div",{class:"__outputs",ref_key:"rightSocketsRefs",ref:De},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,d.SU)(_e),(t=>((0,o.wg)(),(0,o.iD)(o.HY,null,[t?(0,o.wy)(((0,o.wg)(),(0,o.j4)(v.Z,{key:t.id,onPointerdown:[(0,a.iM)((e=>Le(t,e)),["left","shift"]),(0,a.iM)((e=>Ye(t,e)),["right","exact"])],node:e.node,intf:t,highlighted:n.interfaces.includes(t),picked:Ie(t),switchSides:Re},null,8,["onPointerdown","node","intf","highlighted","picked"])),[[p,void 0,"500"]]):((0,o.wg)(),(0,o.iD)("div",q," "))],64)))),256))],512),(0,o._)("div",{class:"__inputs",ref_key:"leftSocketsRefs",ref:Pe},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)((0,d.SU)(ke),(t=>((0,o.wg)(),(0,o.iD)(o.HY,null,[t?(0,o.wy)(((0,o.wg)(),(0,o.j4)(v.Z,{key:t.id,onPointerdown:[(0,a.iM)((e=>Le(t,e)),["left","shift"]),(0,a.iM)((e=>Ye(t,e)),["right"])],node:e.node,intf:t,highlighted:n.interfaces.includes(t),picked:Ie(t),switchSides:Re},null,8,["onPointerdown","node","intf","highlighted","picked"])),[[p,void 0,"500"]]):((0,o.wg)(),(0,o.iD)("div",z," "))],64)))),256))],512),Oe.value?((0,o.wg)(),(0,o.j4)(N,{key:0,modelValue:Oe.value,"onUpdate:modelValue":r[4]||(r[4]=e=>Oe.value=e),x:je.value,y:Ae.value,items:Ue.value,style:(0,i.j5)((0,d.SU)(h)),onClick:Ze},null,8,["modelValue","x","y","items","style"])):(0,o.kq)("",!0)])],46,U)}}},X=(0,C.Z)(B,[["__scopeId","data-v-f0e65632"]]),K={key:0},J=["d"],Q=["onPointerdown"],ee=["d"],te=["d"],ne=["d"],oe=["d"];var ie=n(1309);const ae=(0,o.aZ)({extends:l.z8.Connection,props:{isHighlighted:{default:!1},connection:{required:!0}},components:{Anchor:ie.Z},setup(e){const{classes:t}=l.z8.Connection.setup(e),{graph:n}=(0,l.n4)(),{viewModel:i}=(0,l.Dz)(),{interfaceTypes:a}=i.value,s=a.getConnectionStyle(e.connection.from,e.connection.to),r=(0,o.Fl)((()=>({...t.value,"--hover":e.isHighlighted,"--dashed":"dashed"===s.interfaceConnectionPattern,"--dotted":"dotted"===s.interfaceConnectionPattern}))),d=(0,o.Fl)((()=>({"--color":s.interfaceConnectionColor}))),c=(0,M.Z)(700,(t=>{i.value.editor.readonly||(t.preventDefault(),n.value.removeConnection(e.connection))})),u=(e,t)=>[(e+n.value.panning.x)*n.value.scaling,(t+n.value.panning.y)*n.value.scaling],p=(0,o.Fl)((()=>{const[t,n]=u(e.x1,e.y1),[o,a]=u(e.x2,e.y2);return i.value.connectionRenderer.render(t,n,o,a,e.connection)}));return{cssClasses:r,parsedNewD:(0,o.Fl)((()=>{const e=p.value;if(Array.isArray(e)&&e.length){const t=[];for(let n=0;n<e.length-1;n+=1)t.push(`M ${e[n].x} ${e[n].y} L ${e[n+1].x} ${e[n+1].y}`);return t}return e})),onMouseDown:c,onMouseCtrlDown:(t,o)=>{if(i.value.editor.readonly||"orthogonal"!==i.value.connectionRenderer.style)return;t.preventDefault();const a={x:t.offsetX/n.value.scaling-n.value.panning.x,y:t.offsetY/n.value.scaling-n.value.panning.y,id:Date.now()};n.value.addAnchor(a,e.connection,Math.trunc((o-1)/3))},style:d,hasAnchors:(0,o.Fl)((()=>void 0!==e.connection.anchors&&e.connection.anchors.length&&"orthogonal"===i.value.connectionRenderer.style)),removeAnchor:t=>{i.value.editor.readonly||(n.value.events.removeAnchor.emit([e.connection,t]),e.connection.anchors.splice(t,1))}}}}),se=(0,C.Z)(ae,[["render",function(e,t,n,s,r,l){const d=(0,o.up)("Anchor");return e.hasAnchors?((0,o.wg)(),(0,o.iD)("g",K,[(0,o._)("path",{d:e.parsedNewD,class:"connection-wrapper baklava-connection"},null,8,J),e.hasAnchors?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.parsedNewD,((n,s)=>((0,o.wg)(),(0,o.iD)("g",{onPointerdown:[t[0]||(t[0]=(0,a.iM)(((...t)=>e.onMouseDown&&e.onMouseDown(...t)),["left","exact"])),t[1]||(t[1]=t=>{"touch"===t.pointerType&&e.onMouseDown(t)}),(0,a.iM)((t=>e.onMouseCtrlDown(t,s)),["left","ctrl","exact"])]},[(0,o._)("path",{d:n,class:"connection-wrapper baklava-connection"},null,8,ee),(0,o._)("path",{d:n,class:(0,i.C_)(["baklava-connection",e.cssClasses]),style:(0,i.j5)(e.style)},null,14,te)],40,Q)))),256)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.connection.anchors,((t,n)=>((0,o.wg)(),(0,o.j4)(d,{key:t.id,position:t,rightclickCallback:()=>e.removeAnchor(n)},null,8,["position","rightclickCallback"])))),128))],64)):(0,o.kq)("",!0)])):((0,o.wg)(),(0,o.iD)("g",{key:1,onPointerdown:[t[2]||(t[2]=(0,a.iM)(((...t)=>e.onMouseDown&&e.onMouseDown(...t)),["left","exact"])),t[3]||(t[3]=t=>{"touch"===t.pointerType&&e.onMouseDown(t)}),t[4]||(t[4]=(0,a.iM)((t=>e.onMouseCtrlDown(t,0)),["left","ctrl","exact"]))]},[(0,o._)("path",{d:e.parsedNewD,class:"connection-wrapper baklava-connection"},null,8,ne),(0,o._)("path",{d:e.parsedNewD,class:(0,i.C_)(["baklava-connection",e.cssClasses]),style:(0,i.j5)(e.style)},null,14,oe)],32))}]]);function re(e){const t=document.getElementById(e.id),n=t?.getElementsByClassName("__port");return{node:t?.closest(".baklava-node")??null,interface:t,port:n&&n.length>0?n[0]:null}}const le=(0,o.aZ)({extends:l.z8.ConnectionWrapper,props:{connection:{required:!0},isHighlighted:{default:!1}},components:{ConnectionView:se},setup(e){const t=(0,d.iH)(null),{graph:n}=(0,l.n4)();let i;const a=(0,d.iH)({x1:0,y1:0,x2:0,y2:0}),s=(0,o.Fl)((()=>e.connection.isInDanger?2:0)),r=(0,o.Fl)((()=>n.value.findNodeById(e.connection.from.nodeId)?.position)),c=(0,o.Fl)((()=>n.value.findNodeById(e.connection.to.nodeId)?.position)),u=(0,o.Fl)((()=>n.value.findNodeById(e.connection.from.nodeId))),p=(0,o.Fl)((()=>n.value.findNodeById(e.connection.to.nodeId))),h=(0,o.Fl)((()=>[...Object.values(u.value?.inputs??{}),...Object.values(u.value?.outputs??{})].map((e=>[e.side,e.sidePosition])))),v=(0,o.Fl)((()=>[...Object.values(p.value?.inputs??{}),...Object.values(p.value?.outputs??{})].map((e=>[e.side,e.sidePosition])))),g=e=>e.node&&e.interface&&e.port?[e.node.offsetLeft+e.interface.offsetLeft+e.port.offsetLeft+e.port.clientWidth/2,e.node.offsetTop+e.interface.offsetTop+e.port.offsetTop+e.port.clientHeight/2]:[0,0],f=()=>{const t=re(e.connection.from),n=re(e.connection.to);t.node&&n.node&&(i||(i=new ResizeObserver((()=>{f()})),i.observe(t.node),i.observe(n.node)));const[o,s]=g(t),[r,l]=g(n);a.value={x1:o,y1:s,x2:r,y2:l}};return(0,o.YP)([h,v],(async()=>{await(0,o.Y3)(),f()})),(0,o.YP)([r,c],(async()=>{await(0,o.Y3)(),f()}),{deep:!0}),(0,o.bv)((async()=>{await(0,o.Y3)(),f()})),(0,o.Jd)((()=>{i&&i.disconnect()})),{d:a,state:s,containsPoint:e=>e.includes(t.value.$el.firstChild),conn:t}}}),de=(0,C.Z)(le,[["render",function(e,t,n,i,a,s){const r=(0,o.up)("ConnectionView");return(0,o.wg)(),(0,o.j4)(r,{ref:"conn",x1:e.d.x1,y1:e.d.y1,x2:e.d.x2,y2:e.d.y2,state:e.state,connection:e.connection,isHighlighted:e.isHighlighted},null,8,["x1","y1","x2","y2","state","connection","isHighlighted"])}]]),ce={extends:l.z8.TemporaryConnection,components:{ConnectionView:se},setup(e){const{d:t,status:n}=l.z8.TemporaryConnection.setup(e),i=(0,o.Fl)((()=>{let{input:n,output:o}=t.value;return e.connection.from.isInput&&([n,o]=[o,n]),{input:n,output:o}}));return{d:t,swappedD:i,status:n}}},ue=(0,C.Z)(ce,[["render",function(e,t,n,i,a,s){const r=(0,o.up)("ConnectionView");return(0,o.wg)(),(0,o.j4)(r,{x1:i.swappedD.input[0],y1:i.swappedD.input[1],x2:i.swappedD.output[0],y2:i.swappedD.output[1],state:i.status,connection:e.connection,"is-temporary":""},null,8,["x1","y1","x2","y2","state","connection"])}]]),pe={class:"search-bar"},he=(0,o._)("div",{class:"palette-title"},[(0,o._)("span",null,"Nodes browser")],-1),ve={class:"__entry_search"},ge={class:"nodes"};var fe=n(66309);const me={key:0},ye=["onPointerdown"],we=["src"],be=["innerHTML"],_e=["onClick"],ke={class:"__icondiv"},Ee=["onClick"],xe=["onClick","onPointerdown"],Ce=["src"],Ne=["innerHTML"],Pe=["onClick"],De={class:"__icondiv"},Me=["innerHTML"],Se=["onPointerdown"],Ie=["src"],Te=["innerHTML"],He=["onClick"],Le={class:"__icondiv"},Oe=["innerHTML"];var je=n(53742),Ae=n(1062);const Fe={ref:"el"},Ue=["href"],Ze={class:"link_item"},Ye=["src"],$e=["innerHTML"],Re=(e=>((0,o.dD)("data-v-12450553"),e=e(),(0,o.Cn)(),e))((()=>(0,o._)("br",null,null,-1))),Ge=(0,o.aZ)({props:{node:{required:!0}},setup(e){const t=(0,d.iH)(null),{viewModel:n}=(0,l.Dz)();return{el:t,getIconPath:e=>n.value.cache[`./${e}`]??e,nodeRef:(0,d.iH)(e.node)}}}),We=(0,C.Z)(Ge,[["render",function(e,t,n,i,s,r){return(0,o.wg)(),(0,o.j4)(a.uT,{name:"slide-fade"},{default:(0,o.w5)((()=>[(0,o._)("div",Fe,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.nodeRef.URLs,(t=>((0,o.wg)(),(0,o.iD)("a",{key:t.name,href:t.url,class:"__url",target:"_blank",draggable:"false"},[(0,o._)("div",Ze,[void 0!==t.icon?((0,o.wg)(),(0,o.iD)("img",{key:0,src:e.getIconPath(t.icon),draggable:"false"},null,8,Ye)):(0,o.kq)("",!0),(0,o._)("span",{innerHTML:t.name},null,8,$e),Re])],8,Ue)))),128))],512)])),_:1})}],["__scopeId","data-v-12450553"]]);var Ve=n(81904);const qe=(0,o.aZ)({components:{Arrow:je.Z,LinkMenu:We,VerticalEllipsis:Ae.Z,Cross:Ve.Z},props:{nodeTree:{required:!0},onDragStart:{required:!0},depth:{type:Number,default:0},defaultCollapse:{type:Boolean,default:!0},tooltip:{required:!1},nodeSearch:{type:String,required:!0}},setup(e){const{viewModel:t}=(0,l.Dz)(),n=e=>void 0===e.nodes.nodeTypes?0!==Object.keys(e.subcategories).length:0!==Object.keys(e.nodes.nodeTypes).length,i=(0,d.iH)(Array(Object.keys(e.nodeTree.subcategories??{}).length).fill(!e.defaultCollapse));let a=i.value;(0,o.YP)((()=>e.nodeTree),(()=>{i.value=Array(Object.keys(e.nodeTree.subcategories??{}).length).fill(!e.defaultCollapse)})),(0,o.YP)((()=>e.nodeSearch),((t,n)=>{""!==t&&""===n?(a=i.value,i.value=Array(Object.keys(e.nodeTree.subcategories??{}).length).fill(!0)):""===t&&""!==n&&(i.value=a)}));const s=(0,o.f3)("menu"),r=T.ZP.getEditorManagerInstance(),c=(0,o.Fl)((()=>r.specificationLoaded.value)),u=e=>e===T.xJ;return{padding:(e,t=!1)=>t?"padding-left: 0":`padding-left: ${10+30*e}px`,mask:i,onMouseDown:e=>{i.value.splice(e,1,!i.value[e])},getRotation:e=>i.value[e]?"left":"right",sortedEntries:(e,t=!1)=>Object.entries(e).sort((([e,o],[i,a])=>{if(t){if(n(o)&&!n(a))return 1;if(!n(o)&&n(a))return-1}return e.toLowerCase().localeCompare(i.toLowerCase())})),getIconPath:e=>t.value.cache[`./${e}`]??e,isCategoryNode:e=>void 0!==e?.categoryNode,notEmptyCategory:n,showMenu:s,showMenuClick:e=>{s.value=s.value.hitSubstring!==e.hitSubstring&&e},closeMenu:()=>{s.value&&(s.value=!1)},specificationLoaded:c,nodeEntryClasses:e=>({__entry:!0,"__node-entry":!0,"__default-graph-node-entry":u(e)}),isDefaultGraphNodeType:u}}}),ze=(0,C.Z)(qe,[["render",function(e,t,n,s,r,l){const d=(0,o.up)("Cross"),c=(0,o.up)("VerticalEllipsis"),u=(0,o.up)("LinkMenu"),p=(0,o.up)("Arrow"),h=(0,o.up)("PaletteCategory",!0),v=(0,o.Q2)("click-outside");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.wy)((0,o._)("div",null,[e.nodeTree.nodes.nodeTypes?((0,o.wg)(),(0,o.iD)("div",me,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.sortedEntries(e.nodeTree.nodes.nodeTypes),(([n,s])=>(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",{style:(0,i.j5)([{width:"100%"},e.padding(e.depth)]),class:(0,i.C_)(e.nodeEntryClasses(n)),key:n},[(0,o._)("div",{onPointerdown:t=>e.onDragStart(n,s,s.iconPath),class:(0,i.C_)(e.nodeEntryClasses(n))},[e.isDefaultGraphNodeType(n)?((0,o.wg)(),(0,o.j4)(d,{key:1,color:"white",rotate:45,class:"__title-icon"})):((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[void 0!==s.iconPath?((0,o.wg)(),(0,o.iD)("img",{key:0,class:"__title-icon",src:e.getIconPath(s.iconPath),draggable:"false"},null,8,we)):(0,o.kq)("",!0)],64)),(0,o._)("div",{class:"__title-label",innerHTML:s.hitSubstring},null,8,be)],42,ye),0!==s.URLs.length?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"__vertical_ellipsis",ref_for:!0,ref:"settings",role:"button",onPointerdown:t[0]||(t[0]=(0,a.iM)((()=>{}),["stop"])),onClick:(0,a.iM)((()=>e.showMenuClick(s)),["stop"])},[(0,o.Wm)(c,{class:"smaller_svg"})],40,_e)):(0,o.kq)("",!0),(0,o._)("div",ke,[!1!==e.showMenu&&e.showMenu.hitSubstring===s.hitSubstring?(0,o.wy)(((0,o.wg)(),(0,o.j4)(u,{key:0,node:e.showMenu,style:{width:"18em"}},null,8,["node"])),[[v,e.closeMenu]]):(0,o.kq)("",!0)])],6)),[[a.F8,s.mask]]))),128))])):(0,o.kq)("",!0)],512),[[a.F8,e.nodeTree.mask]]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.sortedEntries(e.nodeTree.subcategories,!0),(([n,s],r)=>(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",{key:n},[e.notEmptyCategory(s)?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[(0,o._)("div",{class:"__entry __category",onClick:t=>e.onMouseDown(r),style:(0,i.j5)(e.padding(e.depth))},[(0,o.Wm)(p,{rotate:e.getRotation(r),scale:"small"},null,8,["rotate"]),e.isCategoryNode(s)?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",{class:"__entry __node-entry",key:s.title,onClick:t=>e.onMouseDown(r),onPointerdown:t=>e.onDragStart(s.title,s.categoryNode,s.iconPath)},[void 0!==s.categoryNode.iconPath?((0,o.wg)(),(0,o.iD)("img",{key:0,class:"__title-icon",src:e.getIconPath(s.categoryNode.iconPath),draggable:"false"},null,8,Ce)):(0,o.kq)("",!0),(0,o._)("div",{class:"__title-label",innerHTML:s.hitSubstring},null,8,Ne),0!==s.categoryNode.URLs.length?((0,o.wg)(),(0,o.iD)("div",{key:1,class:"__vertical_ellipsis",ref_for:!0,ref:"settings",role:"button",onPointerdown:t[1]||(t[1]=(0,a.iM)((()=>{}),["stop"])),onClick:(0,a.iM)((()=>e.showMenuClick(s)),["stop"])},[(0,o.Wm)(c,{class:"smaller_svg"})],40,Pe)):(0,o.kq)("",!0)],40,xe)),[[a.F8,s.mask]]),(0,o._)("div",De,[!1!==e.showMenu&&e.showMenu.hitSubstring===s.hitSubstring?(0,o.wy)(((0,o.wg)(),(0,o.j4)(u,{key:0,node:e.showMenu.categoryNode,style:{width:"18em"}},null,8,["node"])),[[v,e.closeMenu]]):(0,o.kq)("",!0)])],64)):((0,o.wg)(),(0,o.iD)("div",{key:1,class:"__title",innerHTML:s.hitSubstring},null,8,Me))],12,Ee),(0,o.wy)((0,o._)("div",null,[(0,o.Wm)(h,{nodeTree:s,onDragStart:e.onDragStart,depth:e.depth+1,defaultCollapse:e.defaultCollapse,tooltip:e.tooltip,nodeSearch:e.nodeSearch},null,8,["nodeTree","onDragStart","depth","defaultCollapse","tooltip","nodeSearch"])],512),[[a.F8,e.mask[r]]])],64)):((0,o.wg)(),(0,o.iD)(o.HY,{key:1},[e.isCategoryNode(s)?(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",{class:(0,i.C_)(e.nodeEntryClasses(s.title)),style:(0,i.j5)(e.padding(e.depth)),key:s.title,onPointerdown:t=>e.onDragStart(s.title,s.categoryNode,s.iconPath)},[void 0!==s.categoryNode.iconPath?((0,o.wg)(),(0,o.iD)("img",{key:0,class:"__title-icon",src:e.getIconPath(s.categoryNode.iconPath),draggable:"false"},null,8,Ie)):(0,o.kq)("",!0),(0,o._)("div",{class:"__title-label",innerHTML:s.hitSubstring},null,8,Te),0!==s.categoryNode.URLs.length?((0,o.wg)(),(0,o.iD)("div",{key:1,class:"__vertical_ellipsis",ref_for:!0,ref:"settings",role:"button",onPointerdown:t[2]||(t[2]=(0,a.iM)((()=>{}),["stop"])),onClick:(0,a.iM)((()=>e.showMenuClick(s)),["stop"])},[(0,o.Wm)(c,{class:"smaller_svg"})],40,He)):(0,o.kq)("",!0),(0,o._)("div",Le,[!1!==e.showMenu&&e.showMenu.hitSubstring===s.hitSubstring?(0,o.wy)(((0,o.wg)(),(0,o.j4)(u,{key:0,node:e.showMenu.categoryNode,style:{width:"18em"}},null,8,["node"])),[[v,e.closeMenu]]):(0,o.kq)("",!0)])],46,Se)),[[a.F8,s.mask]]):((0,o.wg)(),(0,o.iD)("div",{key:1,class:"__title",innerHTML:s.hitSubstring},null,8,Oe))],64))])),[[a.F8,s.mask]]))),128))],64)}]]),Be=ze,Xe=e=>{const t={},n={};return e.forEach((e=>{const[t,...o]=e.split("/");Object.keys(n).includes(t)||(n[t]=[]),o.length>0&&n[t].push(o.join("/"))})),Object.entries(n).forEach((([e,n])=>{t[e]=Xe(new Set(n))})),t},Ke=e=>{const[t,n]=e;n.hitSubstring=t,void 0!==n.categoryNode&&(n.categoryNode.hitSubstring=n.categoryNode.title),void 0!==n.nodes.nodeTypes&&Object.entries(n.nodes.nodeTypes).forEach((([,e])=>{e.hitSubstring=e.title})),Object.entries(n.subcategories).forEach((e=>Ke(e)))},Je=e=>{e.mask=!0,void 0!==e.categoryNode&&(e.categoryNode.mask=!0),void 0!==e.nodes.nodeTypes&&Object.values(e.nodes.nodeTypes).forEach((e=>{e.mask=!0})),Object.values(e.subcategories).forEach((e=>Je(e)))},Qe=(e,t,n="")=>{const o={};return Object.entries(e).forEach((([e,i])=>{var a;let s="";s=""===n?e:`${n}/${e}`;const r=null!==(a=t.find((e=>e.categoryName===s)))&&void 0!==a?a:{};if(0!==Object.keys(r).length){const n=[];Object.entries(r.nodeTypes).forEach((([e,t])=>{t.isCategory&&n.push(e)}));const a=Object.keys(r.nodeTypes),l={categoryName:r.categoryName,nodeTypes:{}};let d;a.forEach((e=>{n.includes(e)?d=r.nodeTypes[e]:l.nodeTypes[e]=r.nodeTypes[e]})),o[e]={subcategories:Qe(i,t,s),nodes:l,categoryNode:d,hitSubstring:e,mask:!0}}else o[e]={subcategories:Qe(i,t,s),nodes:{},categoryNode:void 0,hitSubstring:e,mask:!0}})),o},et=(e,t,n)=>Object.entries(e).map((([e,o])=>{var i;let a=!1;const s=u().single(t,e);null!==s&&s.score>-50?(o.hitSubstring=null!==(i=u().highlight(s,"<span>","</span>"))&&void 0!==i?i:"",a=!0):o.hitSubstring=e;let r=!1;return void 0!==o.nodes.nodeTypes&&0!==Object.keys(o.nodes.nodeTypes).length&&(r=Object.values(o.nodes.nodeTypes).map((e=>{var o;const i=u().single(t,e.title);return e.mask=null!==i&&i.score>-50||a||n,e.hitSubstring=null!==i?null!==(o=u().highlight(i,"<span>","</span>"))&&void 0!==o?o:"":e.title,e.mask})).includes(!0)),o.mask=et(o.subcategories,t,a||n)||a||r||n,o.mask})).includes(!0);let tt;const nt=["src"],ot=["innerHTML"],it=(0,o.aZ)({props:{title:{type:String,required:!0},iconPath:{type:String,required:!1},depth:{type:Number,required:!0}},setup(e){const{viewModel:t}=(0,l.Dz)(),n=e=>t.value.cache[`./${e}`]??e;return{nodeIcon:(0,o.Fl)((()=>n(e.iconPath))),padding:(0,o.Fl)((()=>`padding-left: ${10+20*e.depth}px`)),getIconPath:n}}}),at=(0,C.Z)(it,[["render",function(e,t,n,a,s,r){return(0,o.wg)(),(0,o.iD)("div",{class:"__entry __node-entry __dragged",style:(0,i.j5)(e.padding)},[void 0!==e.nodeIcon?((0,o.wg)(),(0,o.iD)("img",{key:0,class:"__title-icon",src:e.nodeIcon,draggable:"false"},null,8,nt)):(0,o.kq)("",!0),(0,o._)("div",{class:"__title-label",innerHTML:e.title},null,8,ot)],4)}],["__scopeId","data-v-cfa387f2"]]);var st=n(8532),rt=n(29549);const lt=(0,o.aZ)({components:{PaletteCategory:Be,PaletteEntry:at,Tooltip:st.Z,Magnifier:rt.Z},setup(){const{viewModel:e}=(0,l.Dz)(),{x:t,y:n}=(0,fe.sIC)(),{transform:i}=(0,l.Hm)(),a=(0,d.iH)(null),s=(0,o.f3)("editorEl"),r=(0,d.iH)(null),c=(0,d.iH)(null);c.value={top:0,left:0,visible:!1,text:""};const u=(0,o.Fl)((()=>{if(!r.value||!s?.value)return{};const{left:e,top:o}=s.value.getBoundingClientRect();return{top:n.value-o+"px",left:t.value-e+"px"}})),p=o=>{if(!document.elementsFromPoint(o.clientX,o.clientY).includes(a.value)){const o=new r.value.nodeInformation.type;e.value.displayedGraph.addNode(o);const a=s.value.getBoundingClientRect(),[l,d]=i(t.value-a.left,n.value-a.top);o.position.x=l,o.position.y=d,r.value=null,document.removeEventListener("pointerup",p),document.removeEventListener("keydown",h)}},h=e=>{"Escape"===e.key&&(r.value=null,document.removeEventListener("pointerup",p),document.removeEventListener("keydown",h))},v=(0,d.iH)(""),g=(0,d.iH)(0),f=(0,d.iH)(!1);(0,o.JJ)("menu",f);const m=(0,o.Fl)((()=>function(e){const{viewModel:t}=(0,l.Dz)(),{editor:n}=t.value,i=Array.from(n.nodeTypes.entries()),a=new Set(i.map((([,e])=>e.category))),s=[T.xJ],r={categoryName:"TopLevel",nodeTypes:{}},d=[];a.forEach((e=>{let t=i.filter((([,t])=>t.category===e));const o=Object.fromEntries(t.map((e=>{const[t]=e;return[t,n.getNodeURLs(t)]}))),a=Object.fromEntries(t.map((e=>{const[t]=e;return[t,n.getNodeIconPath(t)]}))),l=t.filter((([e,t])=>s.includes(e)));if(t=t.filter((([e,t])=>!s.includes(e))),t.length>0){const n=t.map((([e,t])=>[e,Object.assign(Object.assign({},t),{isCategory:t.isCategory,mask:!0,hitSubstring:t.title,iconPath:a[e],URLs:o[e]})]));d.push({categoryName:e,nodeTypes:Object.fromEntries(n)})}r.nodeTypes=Object.fromEntries(l.map((([e,t])=>[e,Object.assign(Object.assign({},t),{isCategory:t.isCategory,mask:!0,hitSubstring:t.title,iconPath:a[e],URLs:o[e]})])))}));const c=new Set(d.map((e=>e.categoryName))),u=Xe(c),p=Qe(u,d);tt&&tt();const h={subcategories:p,nodes:r,categoryNode:void 0,hitSubstring:"All",mask:!0},v={All:h};return tt=(0,o.YP)(e,(e=>{""===e?(Object.entries(v).forEach((e=>Ke(e))),Object.values(v).forEach((e=>Je(e)))):et(v,e.toLowerCase(),!1)})),h}(v))),y=(0,o.Fl)((()=>e.value.collapseSidebar));return(0,o.bv)((()=>{(0,o.Fl)((()=>document.querySelector(".nodes"))).value.addEventListener("scroll",(e=>{g.value=e.target.scrollTop;const t=document.getElementsByClassName("__icondiv");for(let e=0;e<t.length;e+=1)t[e].style.translate=`0px -${g.value.toString()}px`}))})),{draggedNodeStyles:u,draggedNode:r,onDragStart:(e,t,n)=>{r.value={type:e,nodeInformation:t,iconPath:n},document.addEventListener("pointerup",p),document.addEventListener("keydown",h)},nodeTree:m,collapse:y,tooltip:c,nodeSearch:v,paletteRef:a,scroll:g}}}),dt=(0,C.Z)(lt,[["render",function(e,t,n,s,r,l){const d=(0,o.up)("Magnifier"),c=(0,o.up)("PaletteCategory"),u=(0,o.up)("Tooltip"),p=(0,o.up)("PaletteEntry");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",{ref:"paletteRef",class:(0,i.C_)(["baklava-node-palette",{"hidden-navbar":e.$isMobile}])},[(0,o._)("div",pe,[he,(0,o._)("div",ve,[(0,o.Wm)(d,{color:"gray"}),(0,o.wy)((0,o._)("input",{class:"node-search","onUpdate:modelValue":t[0]||(t[0]=t=>e.nodeSearch=t),placeholder:"Search"},null,512),[[a.nr,e.nodeSearch]])])]),(0,o._)("div",ge,[(0,o.Wm)(c,{nodeTree:e.nodeTree,onDragStart:e.onDragStart,defaultCollapse:e.collapse,tooltip:e.tooltip,nodeSearch:e.nodeSearch},null,8,["nodeTree","onDragStart","defaultCollapse","tooltip","nodeSearch"])]),(0,o.wy)((0,o.Wm)(u,{text:e.tooltip.text,left:e.tooltip.left,top:e.tooltip.top-60},null,8,["text","left","top"]),[[a.F8,e.tooltip.visible]])],2),(0,o.Wm)(a.uT,{name:"fade"},{default:(0,o.w5)((()=>[e.draggedNode?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"baklava-dragged-node",style:(0,i.j5)(e.draggedNodeStyles)},[(0,o.Wm)(p,{title:e.draggedNode.nodeInformation.title,iconPath:e.draggedNode.iconPath,isDragged:!0,depth:0},null,8,["title","iconPath"])],4)):(0,o.kq)("",!0)])),_:1})],64)}]]),ct=[(0,o._)("div",{class:"rectangle-selection"},null,-1)],ut=(0,o.aZ)({setup(){const e=(0,d.iH)(!1),t=(0,d.iH)({x:0,y:0}),n=(0,d.iH)({x:0,y:0}),i=(0,o.Fl)((()=>({xBegin:t?.value.x<n?.value.x?t?.value.x:n?.value.x,yBegin:t?.value.y<n?.value.y?t?.value.y:n?.value.y,xEnd:t?.value.x>=n?.value.x?t?.value.x:n?.value.x,yEnd:t?.value.y>=n?.value.y?t?.value.y:n?.value.y})));return{styles:(0,o.Fl)((()=>({position:"absolute",visibility:e.value?"visible":"hidden",top:`${i.value.yBegin}px`,left:`${i.value.xBegin}px`,width:`${Math.abs(i.value.xEnd-i.value.xBegin)??0}px`,height:`${Math.abs(i.value.yEnd-i.value.yBegin)??0}px`}))),onPointerDown:o=>{e.value=!0,t.value={x:o.pageX,y:o.pageY},n.value={x:o.pageX,y:o.pageY}},onPointerMove:t=>{e.value&&(n.value={x:t.pageX,y:t.pageY})},onPointerUp:()=>{e.value=!1,t.value={x:0,y:0},n.value={x:0,y:0}},selecting:e,boundingRect:i}}}),pt=(0,C.Z)(ut,[["render",function(e,t,n,a,s,r){return(0,o.wg)(),(0,o.iD)("div",{class:"rectangle-selection-border",style:(0,i.j5)(e.styles)},ct,4)}]]);function ht(e,t,n){const o=document.getElementById(t.id),i=n,a=e.panning.x,s=e.panning.y,{scaling:r}=e,l=r*(a+t.position.x),d=r*(s+t.position.y+60),c=o.offsetWidth,u=o.offsetHeight;return l+.09999999999999998*l>i.xBegin&&l+c*r-.09999999999999998*l<i.xEnd&&d+.09999999999999998*d>i.yBegin&&d+u*r-.09999999999999998*d<i.yEnd}const vt=(0,o.aZ)({extends:l.PG,components:{CustomNode:X,PipelineManagerConnection:de,TemporaryConnection:ue,NodePalette:dt,RectangleSelection:pt},emits:["loadFinish"],setup(e,{emit:t}){const{el:i,counter:a,nodes:s,connections:c,selectedNodes:h,nodeContainerStyle:v,keyDown:g,keyUp:f}=l.PG.setup(e),m=(0,d.iH)([]),{graph:y}=(0,l.n4)(),w=function(){const{graph:e}=(0,l.n4)();let t=[],n=-1,i={x:0,y:0};const a=(0,o.Fl)((()=>e.value.panning)),s=(0,p.Z)(a),r=(t,n,o)=>{if(o<=0)return;const i=[t/e.value.scaling-e.value.panning.x,n/e.value.scaling-e.value.panning.y],a=[t/o-e.value.panning.x,n/o-e.value.panning.y],s=[a[0]-i[0],a[1]-i[1]],r=window.innerHeight,l=window.innerWidth;(2*e.value.size().graphWidth>l/o||2*e.value.size().graphHeight>r/o||o>e.value.scaling&&e.value.size().graphHeight!==-1/0)&&(e.value.scaling=o,e.value.panning.x+=s[0],e.value.panning.y+=s[1])},d=()=>({ax:t[0].clientX,ay:t[0].clientY,bx:t[1].clientX,by:t[1].clientY});return{...s,onPointerDown:e=>{if(s.onPointerDown(e),t.length<=1&&t.push(e),2===t.length){const{ax:e,ay:t,bx:o,by:a}=d(),s=e-o,r=t-a;n=Math.sqrt(s*s+r*r),i={x:e+(o-e)/2,y:t+(a-t)/2}}},onPointerMove:o=>{if(2===t.length){for(let e=0;e<t.length;e+=1)if(o.pointerId===t[e].pointerId){t[e]=o;break}const{ax:a,ay:s,bx:l,by:c}=d(),u=a-l,p=s-c,h=Math.sqrt(u*u+p*p);if(n>0){const t=e.value.scaling*(1+(h-n)/500);r(i.x,i.y,t)}n=h}else s.onPointerMove(o)},onPointerUp:e=>{s.onPointerUp(),t=t.filter((t=>t.pointerId!==e.pointerId)),n=-1},onMouseWheel:t=>{t.preventDefault();let n=t.deltaY;1===t.deltaMode&&(n*=32);const o=Math.min(e.value.scaling*(1-n/3e3),1.5);r(t.clientX,t.clientY,o)}}}(),b=function(){const{graph:e}=(0,l.n4)(),t=(0,d.iH)(null),n=(0,d.iH)(null);let i=null;return(0,o.JJ)("hoveredOver",(o=>{if(n.value=o??null,o&&t.value){t.value.to=o;const n=e.value.checkConnection(t.value.from,t.value.to);if(t.value.status=n.connectionAllowed?1:2,n.connectionAllowed){const t=n.connectionsInDanger.map((e=>e.id));e.value.connections.forEach((e=>{t.includes(e.id)&&(e.isInDanger=!0)}))}}else!o&&t.value&&(t.value.to=void 0,t.value.status=0,e.value.connections.forEach((e=>{e.isInDanger=!1})))})),{temporaryConnection:t,onMouseMove:n=>{if(t.value)if("touch"===n.pointerType){const o=document.elementFromPoint(n.clientX,n.clientY);i&&i!==o&&(i.dispatchEvent(new PointerEvent("pointerout")),i=null),o&&o.classList.contains("__port")&&(o.dispatchEvent(new PointerEvent("pointerover")),i=o),t.value.mx=n.clientX/e.value.scaling-e.value.panning.x,t.value.my=n.clientY/e.value.scaling-e.value.panning.y}else t.value.mx=n.offsetX/e.value.scaling-e.value.panning.x,t.value.my=n.offsetY/e.value.scaling-e.value.panning.y},onMouseDown:e=>{i=e.target,n.value&&(t.value={status:0,from:n.value,to:n.value},t.value.mx=void 0,t.value.my=void 0)},onMouseUp:()=>{t.value&&n.value&&e.value.addConnection(t.value.from,t.value.to),t.value=null}}}(),_=T.ZP.getEditorManagerInstance(),k=(0,d.iH)([]),E=(0,d.iH)([]),x=(0,o.Fl)((()=>e.viewModel.editor.readonly)),C=(0,o.Fl)((()=>e.viewModel.editor.hideHud)),N=(0,d.iH)(null),P=[],D=(0,o.Fl)((()=>y.value.scaling)),M=(0,o.Fl)((()=>e.viewModel.editor.searchQuery)),S=(0,d.iH)([]);let I=0;const O=(0,o.Fl)((()=>({"--scale":D.value,cursor:w.dragging.value?"move":"default"}))),j=()=>{e.viewModel.displayedGraph.selectedNodes=[]},A=()=>{y.value.nodes.forEach((e=>{if(y.value.selectedNodes.includes(e))return;const t=N.value.boundingRect;ht(y.value,e,t)&&y.value.selectedNodes.push(e)}))};let F=0;const U=e=>{w.onPointerMove(e),b.onMouseMove(e),N.value.onPointerMove(e),N.value.selecting&&(y.value.selectedNodes=[],y.value.nodes.forEach((e=>{const t=N.value.boundingRect;ht(y.value,e,t)&&y.value.selectedNodes.push(e)})))},Z=e=>{w.onPointerUp(e),b.onMouseUp(),new Date-I<100&&e.target===i.value&&j(),1===F&&(document.removeEventListener("pointerup",Z),document.removeEventListener("pointermove",U)),F-=1},Y=e=>{new Date-I>=100&&e.target===i.value&&A(),N.value.onPointerUp(),document.removeEventListener("pointerup",Y),document.removeEventListener("pointermove",U)},$=()=>{y.value.selectedNodes=P.value,A(),N.value.onPointerUp(),document.removeEventListener("pointerup",$),document.removeEventListener("pointermove",U)};document.addEventListener("pointerdown",(e=>{0!==e.button||e.shiftKey||((e=>{F+=1,e.target===i.value&&w.onPointerDown(e),b.onMouseDown(e),I=new Date})(e),document.addEventListener("pointerup",Z),document.addEventListener("pointermove",U)),x.value||(2===e.button&&e.ctrlKey?((e=>{N.value.onPointerDown(e),P.value=y.value.selectedNodes})(e),document.addEventListener("pointerup",$),document.addEventListener("pointermove",U)):2===e.button&&((e=>{e.target===i.value&&(j(),N.value.onPointerDown(e)),I=new Date})(e),document.addEventListener("pointerup",Y),document.addEventListener("pointermove",U)))}));const R=()=>{k.value.splice(0,k.value.length)};(0,o.YP)(c.value,(()=>{R()})),(0,o.YP)(b?.temporaryConnection,(()=>{if(void 0!==(b??null)&&null!==b?.temporaryConnection)if(b?.temporaryConnection?.value?.from)for(let e=0;e<s.value.length;e+=1)[...Object.values(s.value[e].outputs)||[],...Object.values(s.value[e].inputs)||[]].forEach((e=>{var t;e.port&&e!==b.temporaryConnection.value.from&&(y.value.checkConnection(b.temporaryConnection.value.from,e).connectionAllowed||(t=e,E.value.includes(t)||E.value.push(t)))}));else E.value.splice(0,E.value.length)}));const G=(0,o.Fl)((()=>e.viewModel.ignoredLayers)),W=(0,o.Fl)((()=>e.viewModel.layers)),V=(0,o.Fl)((()=>{const e=new Set;return W.value.forEach((t=>{t.nodeInterfaces&&G.value.has(t.name)&&t.nodeInterfaces.forEach(e.add,e)})),e})),q=(0,o.Fl)((()=>{const e=new Set;return W.value.forEach((t=>{t.nodeLayers&&G.value.has(t.name)&&t.nodeLayers.forEach(e.add,e)})),e})),z=(0,o.Fl)((()=>s.value.filter((e=>!q.value.has(e.layer))))),B=(0,o.Fl)((()=>s.value.filter((e=>q.value.has(e.layer))))),X=(0,o.Fl)((()=>B.value.map((e=>e.id)))),K=(0,o.Fl)((()=>c.value.filter((e=>!(e.from.type?.some((e=>V.value.has(e)))||e.to.type?.some((e=>V.value.has(e)))||X.value.includes(e.from.nodeId)||X.value.includes(e.to.nodeId)))))),J=(0,L.Z)();J.backendAvailable&&((0,o.YP)(z,(async(e,t)=>{if(!_.notifyWhenChanged)return;const n=Object.values(e).map((e=>e.id)),o=Object.values(t).map((e=>e.id)),i=[];Object.values(e).forEach((e=>{o.includes(e.id)||i.push(e.save())}));const a=[];Object.values(t).forEach((e=>{n.includes(e.id)||a.push(e.id)}));const s={graph_id:y.value.id,nodes:{added:i,deleted:a}};await J.notifyAboutChange("nodes_on_change",s)})),(0,o.YP)(K,(async(e,t)=>{if(!_.notifyWhenChanged)return;const n=Object.values(e).map((e=>e.id)),o=Object.values(t).map((e=>e.id)),i=[];Object.values(e).forEach((e=>{o.includes(e.id)||i.push({id:e.id,from:e.from.id,to:e.to.id})}));const a=[];Object.values(t).forEach((e=>{n.includes(e.id)||a.push({from:e.from.id,to:e.to.id})}));const s={graph_id:y.value.id,connections:{added:i,deleted:a}};await J.notifyAboutChange("connections_on_change",s)})));const Q=(0,o.Fl)((()=>s.value.map((e=>e.title))));(0,o.YP)([M,Q],(()=>{if(void 0===M.value||""===M.value)return S.value=[],void z.value.forEach((e=>{e.highlightedTitle=e.title,e.highlightedType=e.type}));const e=(e=>{const t=z.value.filter((t=>{let{type:n}=t;const o=n.startsWith(r.qM);o&&(n=n.slice(r.qM.length));const i=u().single(e,t.title),a=u().single(e,n);return null!==i&&i.score>-50||null!==a&&a.score>-50?(t.highlightedTitle=u().highlight(i,"<span>","</span>"),t.highlightedType=u().highlight(a,"<span>","</span>"),!o||""===t.title||null!==i):(t.highlightedTitle=t.title,t.highlightedType=t.type,!1)}));return t})(M.value),t=z.value.filter((t=>!e.includes(t)));S.value=t}));const ee=void 0!=={NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_SPECIFICATION_PATH,te=void 0!=={NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_DATAFLOW_PATH;return(0,o.bv)((async()=>{H.Z.setShowNotification(!1),_.updateMetadata({});const o=window.location.search.replace(/&amp;/g,"&"),i=new URLSearchParams(o);if(i.has("preview")){const t="true"===i.get("preview");e.viewModel.editor.preview=t}let a;if(ee)a=n(11562)({NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_SPECIFICATION_PATH);else if(i.has("spec")){const[e,t]=await(0,T.YG)(i.get("spec"));!1===e?(H.Z.terminalLog("error",t),H.Z.terminalLog("error",`Failed to load the specification file from: ${i.get("spec")}`)):a=t}if(void 0!==a){i.has("include")&&(void 0===a.include&&(a.include=[]),a.include.push(i.get("include")));let e,o=await async function(e){let t,n=T.ZP.validateSpecification(e);return n.length?(H.Z.terminalLog("error","Specification is invalid",n),n):(({errors:n,warnings:t}=await _.updateEditorSpecification(e)),Array.isArray(t)&&t.length&&H.Z.terminalLog("warning","Issue when loading specification",t),Array.isArray(n)&&n.length&&H.Z.terminalLog("error","Specification is invalid",n),n)}(a);if(o.length)return H.Z.restoreShowNotification(),void t("loadFinish");if(te)e=n(11562)({NODE_ENV:"production",VUE_APP_STATIC:"true",VUE_APP_VERBOSE:"false",VUE_APP_GRAPH_DEVELOPMENT_MODE:"false",BASE_URL:""}.VUE_APP_DATAFLOW_PATH);else if(i.has("graph")){const[t,n]=await(0,T.YG)(i.get("graph"));!1===t?(H.Z.terminalLog("error",n),H.Z.terminalLog("error",`Failed to load the graph file from: ${i.get("graph")}`)):e=n}if(e){let t;if(({errors:o,warnings:t}=await _.loadDataflow(e)),Array.isArray(t)&&t.length&&H.Z.terminalLog("warning","Issue when loading dataflow",t),Array.isArray(o)&&o.length){const e="Dataflow is invalid";H.Z.terminalLog("error",e,o)}}}H.Z.restoreShowNotification(),t("loadFinish")})),{el:i,counter:a,selectedNodes:h,nodeContainerStyle:v,onRightPointerUp:Y,onDrop:async e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy";const t=[];e.dataTransfer.items?[...e.dataTransfer.items].filter((e=>"file"===e.kind)).forEach((e=>t.push(e.getAsFile()))):t.push(...e.dataTransfer.files),t.length>1&&H.Z.showToast("warning","More than one file dropped, processing only the first one");const n=new FileReader;n.addEventListener("load",(e=>{const t=e.target.result;let n;try{n=JSON.parse(t)}catch(e){return void H.Z.showToast("error","Dropped file is not in JSON format")}if(n.nodes){const e=T.ZP.validateSpecification(n);return e.length?void H.Z.terminalLog("error","Specification is invalid",e):void _.updateEditorSpecification(n).then((({errors:e,warnings:t})=>{Array.isArray(t)&&t.length&&H.Z.terminalLog("warning","Issue when loading specification",t),Array.isArray(e)&&e.length&&H.Z.terminalLog("error","Specification is invalid",e)}))}n.graphs?_.loadDataflow(n).then((({errors:e,warnings:t})=>{if(Array.isArray(t)&&t.length&&H.Z.terminalLog("warning","Issue when loading dataflow",t),Array.isArray(e)&&e.length){const t="Dataflow is invalid";H.Z.terminalLog("error",t,e)}})):H.Z.showToast("error","File is neither specification nor dataflow")})),n.onerror=e=>H.Z.terminalLog("error","File cannot be loaded",e.message),n.readAsText(t[0])},nodes:s,keyDown:g,keyUp:f,selectNode:(t,n)=>{(n&&!n.ctrlKey||!n&&!e.viewModel.commandHandler.pressedKeys.includes("Control"))&&j(),e.viewModel.displayedGraph.selectedNodes.push(t)},rectangleSelection:N,greyedOutNodes:S,temporaryConnection:b.temporaryConnection,mouseWheel:w.onMouseWheel,dragging:w.dragging,changeHoveredConnections:e=>{const t=document.elementsFromPoint(e.clientX,e.clientY),n=m.value.filter((e=>e.containsPoint(t))),o=c.value.filter((e=>n.filter((t=>t.connection===e)).length>0)),i=c.value.filter((e=>o.filter((t=>t.from===e.from)).length>0));c.value.forEach((e=>{var t;i.includes(e)?(t=e,k.value.includes(t)||k.value.push(t)):(e=>{const t=k.value.indexOf(e);t>=0&&k.value.splice(t,1)})(e)}))},highlightConnections:k,connRefs:m,clearHighlight:R,readonly:x,hideHud:C,scale:D,visibleConnections:K,visibleNodes:z,highlightInterfaces:E,editorStyle:O}}}),gt=(0,C.Z)(vt,[["render",function(e,t,n,r,l,d){const c=(0,o.up)("background"),u=(0,o.up)("NodePalette"),p=(0,o.up)("CustomNode"),h=(0,o.up)("PipelineManagerConnection"),v=(0,o.up)("TemporaryConnection"),g=(0,o.up)("RectangleSelection");return(0,o.wg)(),(0,o.iD)("div",{ref:"el",tabindex:"-1",class:(0,i.C_)(["baklava-editor",{"baklava-ignore-mouse":!!e.temporaryConnection||e.dragging,"--temporary-connection":!!e.temporaryConnection}]),style:(0,i.j5)(e.editorStyle),onWheel:t[5]||(t[5]=(0,a.iM)(((...t)=>e.mouseWheel&&e.mouseWheel(...t)),["self"])),onKeydown:t[6]||(t[6]=(...t)=>e.keyDown&&e.keyDown(...t)),onKeyup:t[7]||(t[7]=(...t)=>e.keyUp&&e.keyUp(...t)),onMouseleave:t[8]||(t[8]=t=>!e.readonly&&e.onRightPointerUp),onDrop:t[9]||(t[9]=(0,a.iM)((t=>!e.readonly&&e.onDrop(t)),["prevent"])),onDragenter:t[10]||(t[10]=(0,a.iM)((()=>{}),["prevent"])),onDragover:t[11]||(t[11]=(0,a.iM)((()=>{}),["prevent"])),oncontextmenu:"return false;"},[(0,o.WI)(e.$slots,"background",{},(()=>[(0,o.Wm)(c)])),e.readonly||e.hideHud?(0,o.kq)("",!0):(0,o.WI)(e.$slots,"palette",{key:0},(()=>[(0,o.Wm)(u)])),(0,o._)("div",{class:"node-container",style:(0,i.j5)(e.nodeContainerStyle),onWheel:t[0]||(t[0]=(...t)=>e.mouseWheel&&e.mouseWheel(...t))},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.visibleNodes,(t=>((0,o.wg)(),(0,o.j4)(p,{key:t.id+e.counter.toString(),node:t,selected:e.selectedNodes.includes(t),greyedOut:e.greyedOutNodes.includes(t),interfaces:e.highlightInterfaces,onSelect:n=>e.selectNode(t,n)},null,8,["node","selected","greyedOut","interfaces","onSelect"])))),128))],36),((0,o.wg)(),(0,o.iD)("svg",{class:"connections-container",onMouseenter:t[1]||(t[1]=(...t)=>e.changeHoveredConnections&&e.changeHoveredConnections(...t)),onMousemove:t[2]||(t[2]=(...t)=>e.changeHoveredConnections&&e.changeHoveredConnections(...t)),onMouseleave:t[3]||(t[3]=(...t)=>e.clearHighlight&&e.clearHighlight(...t)),onWheel:t[4]||(t[4]=(...t)=>e.mouseWheel&&e.mouseWheel(...t))},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.visibleConnections,(t=>((0,o.wg)(),(0,o.j4)(h,{key:t.id+e.counter.toString(),connection:t,ref_for:!0,ref:"connRefs",isHighlighted:e.highlightConnections.includes(t)},null,8,["connection","isHighlighted"])))),128)),e.temporaryConnection?((0,o.wg)(),(0,o.j4)(v,{key:0,name:"temporaryConnection","temporary-connection":e.temporaryConnection,connection:e.temporaryConnection},null,8,["temporary-connection","connection"])):(0,o.kq)("",!0)],32)),(0,o._)("div",s,[(0,o.Wm)(g,{ref:"rectangleSelection"},null,512)])],38)}]]),ft=gt},11562:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=11562,e.exports=t},58896:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=58896,e.exports=t},90779:(e,t,n)=>{"use strict";n.d(t,{Dx:()=>a,Vd:()=>s,ZF:()=>r});var o=n(3823),i=n(44773);function a(e){switch(e){case"InputInterface":case"SelectInterface":case"ListInterface":case"TextInterface":case"HexInterface":return!0;default:return!1}}function s(e,t,n,o=void 0,i=!1){const a=t.sidePosition;t.side=n,void 0!==o&&(t.sidePosition=o);const s=[...Object.values(e.inputs),...Object.values(e.outputs)].find((e=>e.id!==t.id&&e.sidePosition===t.sidePosition&&e.side===t.side));if(void 0!==s)if(void 0!==o&&i)s.sidePosition=a;else{const n=void 0===o?t:s,i=[...Object.values(e.inputs),...Object.values(e.outputs)].filter((e=>e.side===n.side&&!e.hidden)).map((e=>e.sidePosition));let a=0;for(;i.includes(a);)a+=1;n.sidePosition=a}}function r(e,t=!1){if(e.type.startsWith(i.qM)&&t){const{viewModel:t}=(0,o.Dz)();t.value.editor.unwrapSubgraph(e)}else{const{graph:t}=(0,o.n4)();t.value.removeNode(e)}}},87707:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var o=n(70828),i=n(44773),a=n(3823),s=n(2262),r=n(66252),l=n(19173),d=n(88518),c=n(57632),u=n(55873),p=n(120),h=n(90779),v=n(92294),g=n(44653),f=n(88272),m=n(60810),y=n(77484),w=n(61598);class b extends o.M{preview=!1;_hideHud=!1;get hideHud(){return this._hideHud||this.preview}set hideHud(e){this._hideHud=e}_readonly=!1;get readonly(){return this._readonly||this.preview}set readonly(e){this._readonly=e}allowLoopbacks=!1;nodeIcons=new Map;baseURLs=new Map;baseIconUrls=new Map;nodeURLs=new Map;layoutManager=new v.Z;subgraphStack=[];registerGraph(e){const t=function(e){return e.events.addAnchor=new u.E,e.events.removeAnchor=new u.E,e.graphNode=void 0,e.checkConnection=function(e,t){if(!e||!t)return{connectionAllowed:!1,error:"Invalid from and to references."};const n=this.findNodeById(e.nodeId),o=this.findNodeById(t.nodeId);if(n&&o&&n===o&&!this.editor.allowLoopbacks)return{connectionAllowed:!1,error:"Loopbacks are not allowed."};if("input"===e.direction&&"output"===t.direction||"input"===e.direction&&"inout"===t.direction||"inout"===e.direction&&"output"===t.direction){const n=e;e=t,t=n}if(e.isInput&&"inout"!==e.direction)return{connectionAllowed:!1,error:"Connections are only allowed from output or inout interfaces."};if(!t.isInput)return{connectionAllowed:!1,error:"Connections are only allowed to input or inout interfaces."};if(this.connections.some((n=>n.from===e&&n.to===t)))return{connectionAllowed:!1,error:"Duplicate connections are not allowed."};if(e.maxConnectionsCount>0&&e.connectionCount+1>e.maxConnectionsCount)return{connectionAllowed:!1,error:`Too many connections from an input interface '${e.id}', maximum of '${e.maxConnectionsCount}' are allowed.`};if((0===t.maxConnectionsCount||void 0===t.maxConnectionsCount)&&t.connectionCount>0)return{connectionAllowed:!1,error:`By default only one connection to an input interface '${t.id}' allowed.`};if(t.maxConnectionsCount>0&&t.connectionCount+1>t.maxConnectionsCount)return{connectionAllowed:!1,error:`Too many connections to an output interface '${t.id}', maximum of '${t.maxConnectionsCount}' are allowed.`};if(e.type&&t.type){const n="string"==typeof e.type||e.type instanceof String?[e.type]:e.type,o="string"==typeof t.type||t.type instanceof String?[t.type]:t.type;if(void 0===n.find((e=>o.includes(e))))return{connectionAllowed:!1,error:`No common types between interfaces. Interface '${e.id}' supports types '${n}' and interface '${t.id}' supports types '${o}'.`}}return this.events.checkConnection.emit({from:e,to:t}).prevented?{connectionAllowed:!1,error:`Connection between an input interface '${e.id}' and an output interface '${t.id}' was prevented`}:this.hooks.checkConnection.execute({from:e,to:t}).some((e=>!e.connectionAllowed))?{connectionAllowed:!1,errors:`Connection between an input interface '${e.id}' and an output interface '${t.id}' was prevented`}:{connectionAllowed:!0,dummyConnection:new l.E(e,t),connectionsInDanger:[]}},e.addAnchor=function(t,n,o){const i={x:t.x,y:t.y,id:(0,c.Z)()};void 0===n.anchors&&(n.anchors=[]),n.anchors.splice(o,0,i),e.events.addAnchor.emit([n,3*o+1])},e.replaceNode=function(e,t){const n=e.position,o=new(this.editor.nodeTypes.get(t).type);e.title!==e.type&&(o.title=e.title),Object.entries({...e.inputs,...e.outputs}).forEach((([e,t])=>{void 0!==t.direction?(Object.prototype.hasOwnProperty.call(o.inputs,e)&&(0,h.Vd)(o,o.inputs[e],t.side,t.sidePosition),Object.prototype.hasOwnProperty.call(o.outputs,e)&&(0,h.Vd)(o,o.outputs[e],t.side,t.sidePosition)):Object.prototype.hasOwnProperty.call(o.inputs,e)&&o.inputs[e].componentName===t.componentName&&(o.inputs[e].value=t.value)}));const i=[...Object.values(e.inputs),...Object.values(e.outputs)],a=this.connections.filter((e=>i.includes(e.from)||i.includes(e.to))),s=[];return Object.entries({...e.inputs,...e.outputs}).forEach((([e,t])=>{void 0!==t.direction&&a.forEach((n=>{if(Object.prototype.hasOwnProperty.call(o.inputs,e))if(n.from===t){const t=new l.e(o.inputs[e],n.to);t.anchors=n.anchors,s.push(t)}else if(n.to===t){const t=new l.e(n.from,o.inputs[e]);t.anchors=n.anchors,s.push(t)}if(Object.prototype.hasOwnProperty.call(o.outputs,e))if(n.from===t){const t=new l.e(o.outputs[e],n.to);t.anchors=n.anchors,s.push(t)}else if(n.to===t){const t=new l.e(n.from,o.outputs[e]);t.anchors=n.anchors,s.push(t)}}))})),o.position=n,(0,p.Yr)(),this.removeNode(e),this.addNode(o),s.forEach((e=>this.internalAddConnection(e))),(0,p._c)(),o},e.addNode=function(e){if(!this.events.beforeAddNode.emit(e).prevented){if(this.nodeEvents.addTarget(e.events),this.nodeHooks.addTarget(e.hooks),e.registerGraph(this),void 0!==e.template){const t=JSON.parse(JSON.stringify(e.template.save()));t.id??=(0,c.Z)(),e.template=new d.o(t,this.editor)}return this._nodes.push(e),(e=this.nodes.find((t=>t.id===e.id))).onPlaced(),this.events.addNode.emit(e),e}},e.destroy=function(){},e.load=function(t){const n=[];for(let e=this.connections.length-1;e>=0;e-=1)this.removeConnection(this.connections[e]);for(let e=this.nodes.length-1;e>=0;e-=1)this.removeNode(this.nodes[e]);return this.id=t.id??(0,c.Z)(),this.name=t.name??void 0,t.nodes.forEach((e=>{void 0!==e.subgraph&&(e.name=`${i.qM}${e.name}`);const t=this.editor.nodeTypes.get(e.name);if(t){const o=new t.type,i=o.id;this.addNode(o);const a=o.load(e);Array.isArray(a)&&a.length&&n.push(...a),o.id??=i}else n.push(`Node type ${e.name} is not registered`)})),t.connections.forEach((e=>{e.id??=(0,c.Z)()})),t.connections.forEach((o=>{const i=this.findNodeInterface(o.from),a=this.findNodeInterface(o.to);if(i)if(i.port)if(a)if(a.port)if(t.connections.some((e=>e.id===o.id&&(e.from!==o.from||e.to!==o.to))))n.push(`Connection of id '${o.id}' invalid. ID is already taken.`);else{const t=this.checkConnection(i,a);if(t.connectionAllowed){t.connectionsInDanger.forEach((e=>{const t=this.connections.find((t=>t.id===e.id));t&&this.removeConnection(t)}));const n=new l.e(t.dummyConnection.from,t.dummyConnection.to);o.anchors?.forEach(((t,o)=>{e.addAnchor(t,n,o)})),this.internalAddConnection(n)}else n.push(`Could not create connection of id '${o.id}'. ${t.error}`)}else n.push(`Connection of id '${o.id}' invalid. Destination of the connection is not an Interface`);else n.push(`Connection of id '${o.id}' invalid. Could not find interface with id '${o.to}'`);else n.push(`Connection of id '${o.id}' invalid. Source of the connection is not an Interface`);else n.push(`Connection of id '${o.id}' invalid. Could not find interface with id '${o.from}'`)})),this.hooks.load.execute(t),n},e.size=function(){const e=this.nodes.map((e=>{const t=document.getElementById(e.id);return{width:t.offsetWidth,height:t.offsetHeight,position:e.position}})),t=100,n=Math.max(...e.map((e=>e.position.x+e.width)))+t,o=Math.min(...e.map((e=>e.position.x)))-t,i=Math.max(...e.map((e=>e.position.y+e.height)))+t,a=Math.min(...e.map((e=>e.position.y)))-t;return{graphHeight:i-a,graphWidth:n-o,rightmostX:n,leftmostX:o,bottommostY:i,topmostY:a}},e.save=function(){const e={id:this.id,name:this.name,nodes:this.nodes.map((e=>e.save())),connections:this.connections.map((e=>({id:e.id,from:e.from.id,to:e.to.id,anchors:e.anchors?.map((e=>({x:e.x,y:e.y})))}))),scaling:this.scaling,panning:this.panning};return this.hooks.save.execute(e)},e.removeSelectedNodes=function(){for(let e=this.selectedNodes.length-1;e>=0;e-=1)this.removeNode(this.selectedNodes[e])},e.removeNode=function(e){if(this.nodes.includes(e)){if(this.events.beforeRemoveNode.emit(e).prevented)return;const t=[...Object.values(e.inputs),...Object.values(e.outputs)];t.forEach((e=>{e.externalName&&this.editor.privatizeInterface(this.id,e)})),this.connections.filter((e=>t.includes(e.from)||t.includes(e.to))).forEach((e=>this.removeConnection(e))),this._nodes.splice(this.nodes.indexOf(e),1),this.events.removeNode.emit(e),e.onDestroy(),this.nodeEvents.removeTarget(e.events),this.nodeHooks.removeTarget(e.hooks)}},e.removeNodeOnly=function(e){this._nodes.splice(this.nodes.indexOf(e),1),this.events.removeNode.emit(e),e.onDestroy(),this.nodeEvents.removeTarget(e),this.nodeHooks.removeTarget(e)},e.obtainExposedNames=function(){const e=[];return this._nodes.forEach((t=>{Object.values({...t.inputs,...t.outputs}).forEach((t=>{void 0!==t.externalName&&e.push(t.externalName)}))})),e},e.isIncorrectExternalName=function(e,t){const n=t.filter((t=>t===e)).length;return 0===e.length||0!==n},e.resolveNewExposedName=function(e){const t=this.obtainExposedNames();let n=1,o=e;for(;this.isIncorrectExternalName(o,t);)o=`${e}_${n}`,n+=1;return o},e}(e);super.registerGraph(t)}save(){const e=this._graph.id,t=Array.from((0,s.IU)(this.subgraphStack));t.forEach(this.backFromSubgraph.bind(this));const n=this.graph.save();n.panning=this._graph.panning,n.scaling=this._graph.scaling;const o={graphs:[]},i=e=>{void 0!==e.subgraph&&(o.graphs.push(e.graphState),e.graphState.nodes.forEach(i)),delete e.graphState};return n.nodes.forEach(i),o.graphs.length&&(o.entryGraph=e),o.graphs=[n,...o.graphs],t.forEach((([e,t])=>{const n=this.switchToSubgraph(t);if(Array.isArray(n)&&n.length)throw new Error(n)})),o}deepCleanEditor(e=!0){this.subgraphStack.forEach(this.backFromSubgraph.bind(this)),this.cleanEditor(e),this.graphName=void 0}cleanEditor(e=!0){const t=this._graph;(0,p.GU)(e);for(let e=t.connections.length-1;e>=0;e-=1)t.removeConnection(t.connections[e]);for(let e=t.nodes.length-1;e>=0;e-=1)t.removeNode(t.nodes[e]);(0,p.GU)(!1)}unregisterGraphs(){[...this.graphs].filter((e=>e.id!==this._graph.id)).forEach((e=>this.unregisterGraph(e))),this.subgraphStack=[]}unregisterNodes(){this.nodeTypes.forEach(((e,t)=>{this.unregisterNodeType(t)}))}registerNodeType(e,t){if(this.events.beforeRegisterNodeType.emit({type:e,options:t}).prevented)return;const n=new e;this._nodeTypes.set(n.type,{type:e,category:t?.category??"default",title:t?.title??n.title,isCategory:t?.isCategory??!1}),this.events.registerNodeType.emit({type:e,options:t})}async load(e,t=!1,n=!1){this.unregisterGraphs(),w.ir.clearRegistry();const o=new Set,i=t=>{const n=[];if(void 0!==t.subgraph){const a=e.graphs.filter((e=>e.id===t.subgraph));if(1!==a.length)return[`Expected exactly one template with ID ${t.name}, got ${a.length}`];if(o.has(t.subgraph))return[`Subgraph ${t.subgraph} has multiple nodes pointing to it - only unique IDs are allowed`];o.add(t.subgraph),t.graphState=structuredClone(a[0]),t.graphState.nodes.forEach((e=>{n.push(...i(e))}))}return n},a=this.readonly;this.readonly=!0;let s,l=[];if(!e.graphs.length)return["No graphs found"];if(e.entryGraph){if(s=e.graphs.find((t=>t.id===e.entryGraph)),!s)return[`No entry graph found of id '${e.entryGraph}'`]}else s=e.graphs[0];const{panning:d,scaling:c}=s,u=new Set;e.graphs.forEach((e=>{e.nodes.forEach((e=>{void 0!==e.subgraph&&u.add(e.subgraph)}))}));const p=e.graphs.find((e=>!u.has(e.id)));if(void 0===p)return["No root graph found. Make sure you graph does not have any reccurency"];try{if(p.nodes.forEach((e=>{l.push(...i(e))})),l.length)return l;e=this.hooks.load.execute(e),l=this._graph.load(p)}catch(e){return this.cleanEditor(),this.readonly=a,[e.toString()]}if(Array.isArray(l)&&l.length)return this.cleanEditor(),this.readonly=a,l;if(this.events.loaded.emit(),this.graphName=s.name,this.readonly=a,"undefined"==typeof window||n)return l;const h=(e,t)=>{if(void 0!==e?.nodes)for(let n=0;n<e.nodes.length;n+=1)if(void 0!==e.nodes[n].subgraph){if(e.nodes[n].subgraph.id===s.id)return[...t,e.nodes[n]];const o=h(e.nodes[n].subgraph,[...t,e.nodes[n]]);if(o.length)return o}return[]};return h(this._graph,[]).forEach((e=>{this.switchToSubgraph(e)})),"NoLayout"!==this.layoutManager.layoutEngine.activeAlgorithm&&(await(0,r.Y3)(),await this.applyAutolayout(!1)),await(0,r.Y3)(),void 0!==d&&(this._graph.panning=d),void 0!==c&&(this._graph.scaling=c),t||void 0!==c||void 0!==d||this.centerZoom(),l}privatizeInterface(e,t){let n=[...this.graphs].find((t=>t.id===e)),o=n.graphNode;if(t.externalName=void 0,void 0===o)return;const{graphIds:i,sharedInterface:a}=w.ir.getRegisteredInterface(t.id),s=i.findIndex((e=>e===o.graph.id));i.splice(s,i.length-s),o.updateExposedInterfaces();for(let e=s+1;e<i.length;e+=1)n=[...this.graphs].find((e=>e.id===i[s])),o=n.graphNode,o.updateExposedInterfaces();a===t&&w.ir.deleteRegisteredInterface(t.id)}exposeInterface(e,t,n=void 0){const o=[...this.graphs].find((t=>t.id===e)),i=o.graphNode;t.externalName=n??o.resolveNewExposedName(t.name),void 0!==i&&i.updateExposedInterfaces()}static editorSize(){if("undefined"==typeof document)throw new Error("The editor is in browserless mode. Cannot obtain editor size.");const e=document.getElementsByClassName("terminal-wrapper")[0]?.offsetHeight??0,t=document.getElementsByClassName("wrapper")[0]?.offsetHeight??0,n=document.getElementsByClassName("baklava-node-palette");let o=0;if(0!==n.length){const e=n[0].getBoundingClientRect();o=Math.max(e.right,0)}const i=window.innerHeight-e-t;return{editorWidth:window.innerWidth-o,editorHeight:i,sideBarWidth:o}}centerZoom(){if(!Array.isArray(this._graph.nodes)||0===this._graph.nodes.length)return;if("undefined"==typeof document)throw new Error("The editor is in browserless mode. Cannot obtain editor size.");const{editorWidth:e,editorHeight:t,sideBarWidth:n}=b.editorSize(),{graphHeight:o,graphWidth:i,leftmostX:a,topmostY:s}=this._graph.size(),r=100,l=t/(o+200),d=e/(i+200);if(d>l){const t=e/2*(1/l)-(i+200)/2;this._graph.panning={x:-(a-r-t-n/l),y:-(s-r)},this._graph.scaling=l}else{const e=t/2*(1/d)-(o+200)/2;this._graph.panning={x:-(a-r-n/d),y:-(s-r-e)},this._graph.scaling=d}}nodeURLsEmpty(){return 0===this.nodeURLs.size}getNodeURLs(e){const t=this.nodeURLs.get(e)||{},n=[];return Object.entries(t).forEach((([e,t])=>{const o={...this.baseURLs.get(e)};o.url+=t,n.push(o)})),n}getNodeIconPath(e){return this.nodeIcons.get(e)||void 0}addGraphTemplate(e,t,n,o=!1){if(this.events.beforeAddGraphTemplate.emit(e).prevented)return;if(this.nodeTypes.has(`${i.qM}${e.id}`))return;this._graphTemplates.push(e),this.graphTemplateEvents.addTarget(e.events),this.graphTemplateHooks.addTarget(e.hooks);const a=function(e,t){const n=(0,i.Xk)(e);return class extends n{type=`${i.qM}${t}`;title=t;save(){const e=super.save(),t=[];return Object.values(this.inputs).concat(Object.values(this.outputs)).forEach((e=>{t.push({name:e.name,externalName:e.externalName,id:e.id,direction:e.direction,side:e.side,sidePosition:e.sidePosition})})),e.interfaces=t,delete e.inputs,delete e.outputs,e.subgraph=e.graphState.id,e.name=e.type,e.name=e.name.slice(i.qM.length),delete e.type,e.instanceName=""===e.title?void 0:e.title,delete e.title,e}load(e){this.hooks.beforeLoad.execute(e);const t=(0,m.jT)(e.interfaces??[],[],[]);if(Array.isArray(t)&&t.length)return t;let{inputs:n,outputs:o}=t;n=Object.values(n),o=Object.values(o),delete e.graphState.interfaces,delete e.subgraph;const i=this.subgraph.load(e.graphState);return i.length?i:(this.updateExposedInterfaces(n,o),this.subgraph||i.push("Cannot load a graph node without a graph"),this.template||i.push("Unable to load graph node without graph template"),i.length?i:(this.position=e.position,this.title=e.instanceName??"",this.events.loaded.emit(this),[]))}updateExposedInterfaces(e=void 0,t=void 0){const n=(0,y.pP)(this.subgraph.nodes,e??Object.values(this.inputs),t??Object.values(this.outputs));if(Array.isArray(n)&&n.length)throw new Error(`Internal error occurred while exposing an interface.\nReason: ${n.join(". ")}`);this.updateInterfaces(n.inputs,n.outputs)}onPlaced(){this.initialize()}initialize(){this.subgraph&&this.subgraph.destroy();const e=new g.k(this.template.editor),t=this.prepareSubgraphInstance(),n=e.load(t);if(n.length)throw new Error(`Internal error occurred while initializing ${e.type} graph. Reason: ${n.join(". ")}`);e.template=this.template,this.subgraph=e,e.graphNode=this,this.updateExposedInterfaces([],[]),this._title=this.template.name,this.events.update.emit(null)}updateInterfaces(e,t){const n=[...e,...t],o={...this.inputs,...this.outputs};Object.entries(o).forEach((([e,t])=>{if(void 0===n.find((e=>e.id===t.id))){const n="output"===t.direction?"output":"input";this.removeInterface(n,e)}})),n.forEach((e=>{const t=Object.values(o).find((t=>t.id===e.id));if(void 0===t){const t=new f.I(e.name);Object.assign(t,e),w.ir.pushGraphIdToRegistry(t.id,this.graph.id),w.ir.createSharedInterface(t);const n="output"===e.direction?"output":"input";this.addInterface(n,`${e.direction}_${e.name}`,t)}else Object.assign(t,e)}))}prepareSubgraphInstance(){const e=new Map,t=t=>{const n=(0,c.Z)();return e.set(t,n),n},n=t=>{const n=e.get(t);if(!n)throw new Error(`Unable to create graph from template: Could not map old id ${t} to new id`);return n},o=e=>{return n=e,o=e=>({...e,id:t(e.id)}),Object.fromEntries(Object.entries(n).map((([e,t])=>[e,o(t)])));var n,o};return{id:(0,c.Z)(),nodes:this.template.nodes.map((e=>({...e,id:t(e.id),inputs:o(e.inputs),outputs:o(e.outputs)}))),connections:this.template.connections.map((e=>({id:t(e.id),from:n(e.from),to:n(e.to)})))}}}}(e,n);this.registerNodeType(a,{category:t,title:e.name,isCategory:o}),this.events.addGraphTemplate.emit(e)}switchGraph(e){if(void 0===this._switchGraph){const{switchGraph:e}=(0,a.n4)();this._switchGraph=e}(0,p.GU)(!0),this._graph=e.subgraph,this._switchGraph(e.subgraph),this.graphName=this._graph.name,(0,p.GU)(!1),(0,r.Y3)().then((()=>{const e=this.graph.save();this.layoutManager.registerGraph(e),this.layoutManager.computeLayout(e).then(this.updateNodesPosition.bind(this))}))}switchToSubgraph(e){this.subgraphStack.push(e.graph),this.switchGraph(e)}backFromSubgraph(){const e=this.subgraphStack.pop();(0,p.GU)(!0),this._graph=e,this._switchGraph(this._graph),this.graphName=this._graph.name,(0,p.GU)(!1)}findInterface(e){for(let t=0;t<this.graph.nodes.length;t+=1){const n=Object.values(this.graph.nodes[t].inputs).concat(Object.values(this.graph.nodes[t].outputs)).find((t=>t.id===e));if(n)return n}return null}unwrapSubgraph(e){const t=Object.values(e.subgraph._nodes),n=t.map((e=>e.position.x)).reduce(((e,t)=>e+t),0)/t.length,o=t.map((e=>e.position.y)).reduce(((e,t)=>e+t),0)/t.length;this.graph.selectedNodes=[],t.forEach((t=>{const i=t.save(),a=this.graph.addNode(t);a&&(a.position.x+=e.position.x-n,a.position.y+=e.position.y-o,this.graph.selectedNodes.push(a),Object.values(a.inputs).concat(Object.values(a.outputs)).forEach((e=>{e.connectionCount=0})),a.load(i))}));const i=this.graph.connections.filter((t=>t.from.nodeId===e.id||t.to.nodeId===e.id));this.graph.removeNode(e),Object.values(e.subgraph.connections).concat(i).forEach((t=>{if("Connection"===t.from.name||"Connection"===t.to.name)return;const i=this.findInterface(t.from.id),a=this.findInterface(t.to.id);if(i&&a){const s=this.graph.addConnection(i,a);(t.anchors??[]).forEach(((i,a)=>{let r;r=e.subgraph.connections.includes(t)?{x:i.x+e.position.x-n,y:i.y+e.position.y-o}:{x:i.x,y:i.y},this.graph.addAnchor(r,s,a)}))}}))}isInSubgraph(){return this.subgraphStack.length>0}async applyAutolayout(e=!0){const t=this.graph.save();e&&t.nodes.forEach((e=>{e.position=void 0})),this.layoutManager.registerGraph(t);const n=await this.layoutManager.computeLayout(t);this.updateNodesPosition(n)}updateNodesPosition(e){e.nodes.forEach((e=>{this.graph.nodes.filter((t=>e.id===t.id))[0].position=e.position}))}updateCurrentSubgraphName(e){this._graph.name=e}}},90376:(e,t,n)=>{"use strict";n.d(t,{J:()=>s,Y:()=>a});const o={},i=(e,t)=>({beforeMount:(n,i)=>{const a={timeout:null,newEvent:null,longPress:!1,moveEvents:0};o[n]={pointerdown:t=>{"touch"===t.pointerType&&null===a.timeout&&(a.moveEvents=0,a.longPress=!1,e(n,i,t,a),a.timeout=setTimeout((()=>{a.longPress=!0}),i.arg??500))},pointermove:()=>{a.moveEvents+=1},pointerup:e=>{"touch"===e.pointerType&&(a.longPress&&a.moveEvents<10&&t(n,i,e,a),a.timeout&&(clearTimeout(a.timeout),a.timeout=null))}},n.addEventListener("pointerdown",o[n].pointerdown),n.addEventListener("pointermove",o[n].pointermove),n.addEventListener("pointerup",o[n].pointerup)},unmounted:e=>{e.removeEventListener("pointerdown",o[e].pointerdown),e.removeEventListener("pointermove",o[e].pointermove),e.removeEventListener("pointerup",o[e].pointerup)}}),a=i(((e,t,n,o)=>{o.newEvent=n}),((e,t,n,o)=>{setTimeout((()=>t.value(o.newEvent)),50)})),s=i(((e,t,n,o)=>{o.newEvent=new PointerEvent("pointerdown",{button:2,clientX:n.clientX,clientY:n.clientY,screenX:n.screenX,screenY:n.screenY,pointerType:"mouse",relatedTarget:n.relatedTarget})}),((e,t,n,o)=>{setTimeout((()=>{e.dispatchEvent(o.newEvent)}),50)}))}}]);
//# sourceMappingURL=index-7574f2c7.d022c03e.js.map